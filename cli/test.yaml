- name: empty
  input: ''
  expected: ''

- name: number
  args:
    - '.'
  input: '128'
  expected: |
    128

- name: string
  args:
    - '.'
  input: '"Hello, world!\n\t\uff06"'
  expected: |
    "Hello, world!\n\t＆"

- name: object
  input: '{"foo": 128}'
  expected: |
    {
      "foo": 128
    }

- name: object index
  args:
    - '.foo'
  input: '{"foo": 128}'
  expected: |
    128

- name: object index large number
  args:
    - '.foo'
  input: '{"foo": 4722366482869645213696}'
  expected: |
    4722366482869645213696

- name: object index
  args:
    - '.["foo"]'
  input: '{"foo": 128}'
  expected: |
    128

- name: object index by string
  args:
    - '."2\(.foo[])3"'
  input: '{"foo":[1,2],"213":3,"223":6}'
  expected: |
    3
    6

- name: object index by query
  args:
    - '.c[.a + .b]'
  input: '{ "a": "b", "b": "c", "c": {"bc": 128} }'
  expected: |
    128

- name: deep object index by query
  args:
    - '.d[.a][.b][.c]'
  input: '{ "a": "b", "b": "c", "c": "d", "d": { "b": { "c": { "d": 128 } } } }'
  expected: |
    128

- name: object index by iterator
  args:
    - '.c[][.a[] + .b[]]'
  input: '{ "a": ["a", "b"], "b": ["c", "d"], "c": [{"ac": 1, "bc": 2, "ad": 3, "bd": 4}, {"ac": 5, "bc": 6, "ad": 7, "bd": 8}] }'
  expected: |
    1
    5
    2
    6
    3
    7
    4
    8

- name: object index by string iterator
  args:
    - '.c[]."\(.a[])"'
  input: '{ "a": [0,1], "b": [0,2], "c": [{"0":1,"1":2},{"0":3,"1":4}] }'
  expected: |
    1
    3
    2
    4

- name: object index after iterator
  args:
    - '{ message: .[].message }'
  input: '[ {"message": "Hello, world" } ]'
  expected: |
    {
      "message": "Hello, world"
    }

- name: object index error
  args:
    - '.[.a + .b]'
  input: '{"a": 10, "b": 20}'
  error: |
    expected an array but got: object ({"a":10,"b":20})

- name: expected object
  args:
    - '.foo.bar'
  input: '{"foo": 128}'
  error: |
    expected an object but got: number (128)

- name: expected object in pipe
  args:
    - '.foo|.bar'
  input: '{"foo": 128}'
  error: |
    expected an object but got: number (128)

- name: expected object after iterator
  args:
    - '.[]|.foo|.bar'
  input: '[128]'
  error: |
    expected an object but got: number (128)

- name: object index against null
  args:
    - '.foo.bar.baz'
  input: 'null'
  expected: |
    null

- name: object optional
  args:
    - '.foo?.bar?.baz?'
  input: '{"foo": 128}'

- name: object optional error
  args:
    - '.foo.bar.baz?'
  input: '{"foo": 128}'
  error: |
    expected an object but got: number (128)

- name: object optional after iterator error
  args:
    - '.[].foo?'
  input: '128'
  error: |
    cannot iterate over: number (128)

- name: array index
  args:
    - '.[-5],.[-1],.[0],.[2],.[3],.[4]'
  input: '[16, 32, 48, 64]'
  expected: |
    null
    64
    16
    48
    64
    null

- name: array slice
  args:
    - -c
    - '.[2:], .[:2], .[1:3], .[0:4], .[2:1], .[-2:], .[:-2], .[-2:-1], .[-10:], .[:10], .[10:], .[:-10]'
  input: '[16, 32, 48, 64]'
  expected: |
    [48,64]
    [16,32]
    [32,48]
    [16,32,48,64]
    []
    [48,64]
    [16,32]
    [48]
    [16,32,48,64]
    [16,32,48,64]
    []
    []

- name: array index and slice with large number
  args:
    - -c
    - '. as $x | 4722366482869645213696 as $y | $x[-$y], $x[$y], $x[-$y:], $x[:$y], $x[-$y:$y], $x[$y-$y], $x[$y/$y]'
  input: '[16, 32, 48, 64]'
  expected: |
    null
    null
    [16,32,48,64]
    [16,32,48,64]
    [16,32,48,64]
    16
    32

- name: iterator in array index
  args:
    - -c
    - '[.[.[]],.[.[]:],.[:.[]],.[.[]:.[]],.[-.[]],.[--.[]]]'
  input: '[0, 1, 2]'
  expected: |
    [0,1,2,[0,1,2],[1,2],[2],[],[0],[0,1],[],[0],[0,1],[],[],[1],[],[],[],0,2,1,0,1,2]

- name: array index by iterator
  args:
    - '.c[][.a[] + .b[]]'
  input: '{ "a": [0,1], "b": [0,2], "c": [[1,2,3,4],[5,6,7,8]] }'
  expected: |
    1
    5
    2
    6
    3
    7
    4
    8

- name: array slice by iterator
  args:
    - -c
    - '.c[][.a[] : .b[]]'
  input: '{ "a": [0,1], "b": [0,2], "c": [[1,2,3,4],[5,6,7,8]] }'
  expected: |
    []
    []
    [1,2]
    [5,6]
    []
    []
    [2]
    [6]

- name: expected array
  args:
    - '.[0:1]'
  input: '{"foo": 128}'
  error: |
    expected an array but got: object ({"foo":128})

- name: array index against null
  args:
    - '.[0]'
  input: 'null'
  expected: |
    null

- name: array index with array
  args:
    - -c
    - '.[[1],[5,7,9],[],5,[3]]'
  input: '[1,3,5,7,9,8,6,5,4,3,2,1]'
  expected: |
    [0,11]
    [2]
    []
    8
    [1,9]

- name: array index error
  args:
    - '.["foo"]'
  input: '[]'
  error: |
    expected an object but got: array ([])

- name: array slice error
  args:
    - '.[:{}]'
  input: '[]'
  error: |
    expected a number for indexing an array but got: object ({})

- name: string index and slice
  args:
    - -c
    - '[.[-5],.[-1],.[0],.[3],.[4],.[6],.[2:4],.[-4:-2]]'
  input: '"あいうえお"'
  expected: |
    ["あ","お","あ","え","お","","うえ","いう"]

- name: array construction
  args:
    - -c
    - '.,[3,[[2]]],[1],[[.],3]|[.,.]'
  input: 'null'
  expected: |
    [null,null]
    [[3,[[2]]],[3,[[2]]]]
    [[1],[1]]
    [[[null],3],[[null],3]]

- name: iterator
  args:
    - '.foo | .[] | .'
  input: '{"foo": [1,2,{"bar":[]},[3,4,5]]}'
  expected: |
    1
    2
    {
      "bar": []
    }
    [
      3,
      4,
      5
    ]

- name: iterator optional
  args:
    - '.[]?'
  input: '10'

- name: iterator error
  args:
    - '.[][]'
  input: '[10]'
  error: |
    cannot iterate over: number (10)

- name: deep iterator optional
  args:
    - '.[][]?'
  input: '[10]'

- name: object iterator
  args:
    - '.[]'
  input: '{"foo": 128}'
  expected: |
    128

- name: object optional after iterator
  args:
    - '[.[].name?]'
  input: '[ 1, { "name": 2 }, 3, { "name": 4 } ]'
  expected: |
    [
      2,
      4
    ]

- name: pipe
  args:
    - '.foo | .bar'
  input: '{"foo": {"bar": {"baz": 128}}}'
  expected: |
    {
      "baz": 128
    }

- name: null values
  args:
    - '.[] | null'
  input: '["a", 1, [], {}]'
  expected: |
    null
    null
    null
    null

- name: boolean values
  args:
    - '.[] | true, false'
  input: '["a", 1]'
  expected: |
    true
    false
    true
    false

- name: empty value
  args:
    - '.[] | empty, empty, . + [empty,.][], [empty,.][] / 1, empty < ., . and empty, empty or .'
  input: '[0, 1]'
  expected: |
    0
    0
    2
    1

- name: empty function
  args:
    - 'def f: 1,empty,empty,2; f,f'
  input: '[0, 1]'
  expected: |
    1
    2
    1
    2

- name: unary operators
  args:
    - -c
    - 'map(-.[]), map(+.[])'
  input: '[[1,2,3,4722366482869645213696]]'
  expected: |
    [-1,-2,-3,-4722366482869645213696]
    [1,2,3,4722366482869645213696]

- name: unary operators against string
  args:
    - '(-.)'
  input: '"abcdeabcdeabcdeabcdeabcdeabcdeabcdeabcdeabcdeabcde"'
  error: |
    gojq: cannot negate: string ("abcdeabcdeabcdeabcdea ...)

- name: object construction
  args:
    - -c
    - '{ foo: .foo.bar, "bar": .foo, "": false }'
  input: '{"foo":{"bar":["a","b"]}}'
  expected: |
    {"":false,"bar":{"bar":["a","b"]},"foo":["a","b"]}

- name: object construction shortcut
  args:
    - '{foo,"bar",qux,quxx:.foo}'
  input: '{"foo": 1, "bar": 2, "baz": 3}'
  expected: |
    {
      "bar": 2,
      "foo": 1,
      "qux": null,
      "quxx": 1
    }

- name: object construction pipe in value
  args:
    - '{ "bar": { "baz": . } | . | select(true) }'
  input: '{ "foo": 100 }'
  expected: |
    {
      "bar": {
        "baz": {
          "foo": 100
        }
      }
    }

- name: empty object
  args:
    - '{}'
  input: '{"foo":{"bar":["a","b"]}}'
  expected: |
    {}

- name: iterator in object
  args:
    - -c
    - '{ foo: .foo[], bar: .bar[] }'
  input: '{"foo":[1,2],"bar":["a","b"]}'
  expected: |
    {"bar":"a","foo":1}
    {"bar":"b","foo":1}
    {"bar":"a","foo":2}
    {"bar":"b","foo":2}

- name: iterator in object key
  args:
    - -c
    - '{ (.[]): .. }'
  input: '["a", "b"]'
  expected: |
    {"a":["a","b"]}
    {"a":"a"}
    {"a":"b"}
    {"b":["a","b"]}
    {"b":"a"}
    {"b":"b"}

- name: binary operator in object key and value
  args:
    - -c
    - '{ (.[] + .[]): (.[] + .[]) }'
  input: '["foo", "bar"]'
  expected: |
    {"foofoo":"foofoo"}
    {"foofoo":"barfoo"}
    {"foofoo":"foobar"}
    {"foofoo":"barbar"}
    {"barfoo":"foofoo"}
    {"barfoo":"barfoo"}
    {"barfoo":"foobar"}
    {"barfoo":"barbar"}
    {"foobar":"foofoo"}
    {"foobar":"barfoo"}
    {"foobar":"foobar"}
    {"foobar":"barbar"}
    {"barbar":"foofoo"}
    {"barbar":"barfoo"}
    {"barbar":"foobar"}
    {"barbar":"barbar"}

- name: error in object key
  args:
    - -c
    - '{ (.[]): .. }'
  input: '["a", 1]'
  expected: |
    {"a":["a",1]}
    {"a":"a"}
    {"a":1}
  error: |
    expected a string for object key but got: number (1)

- name: error in object value
  args:
    - -c
    - '.[] | { (.k): .a.b }'
  input: '[{"a":{"b":10},"k":"a"}, {"a":10,"k":"b"}]'
  expected: |
    {"a":10}
  error: |
    expected an object but got: number (10)

- name: pipe in object key
  args:
    - '{ (.foo|.bar): .foo.bar }'
  input: '{"foo":{"bar":"baz"}}'
  expected: |
    {
      "baz": "baz"
    }

- name: number in object key
  args:
    - '{ (.foo): .foo }'
  input: '{"foo":10}'
  error: |
    expected a string for object key but got: number (10)

- name: null in object key
  args:
    - '{ (.foo): .foo }'
  input: '{}'
  error: |
    expected a string for object key but got: null

- name: keyword in object key
  args:
    - -c
    - '{if:0,and:1,or:2,then:3,else:4,elif:5,end:6,as:7,def:8,reduce:9,foreach:10,try:11,catch:12,label:13,import:14,include:15,module:16}'
  input: 'null'
  expected: |
    {"and":1,"as":7,"catch":12,"def":8,"elif":5,"else":4,"end":6,"foreach":10,"if":0,"import":14,"include":15,"label":13,"module":16,"or":2,"reduce":9,"then":3,"try":11}

- name: array
  args:
    - '[.foo, ., false]'
  input: '{"foo": {"bar": 128}}'
  expected: |
    [
      {
        "bar": 128
      },
      {
        "foo": {
          "bar": 128
        }
      },
      false
    ]

- name: empty array
  args:
    - '[]'
  input: '{"foo": {"bar": 128}}'
  expected: |
    []

- name: pipe in array
  args:
    - '[.foo|.bar]'
  input: '{"foo": {"bar": 128}}'
  expected: |
    [
      128
    ]

- name: iterator in array
  args:
    - '[.foo|.bar[][]]'
  input: '{"foo": {"bar": [[1],[2],[3]]}}'
  expected: |
    [
      1,
      2,
      3
    ]

- name: error after iterator
  args:
    - '[ .[] | .foo ]'
  input: '[ [1, 2, 3], 4, 5]'
  error: |
    expected an object but got: array ([1,2,3])

- name: function after iterator error
  args:
    - '.[] | .foo | null'
  input: '[1, 2, 3]'
  error: |
    expected an object but got: number (1)

- name: multiple iterators in array
  args:
    - -c
    - '[.[],..,.[]]'
  input: '[1, 2, 3]'
  expected: |
    [1,2,3,[1,2,3],1,2,3,1,2,3]

- name: recurse
  args:
    - -c
    - '..'
  input: '{"foo":{"bar":["a","b"]}}'
  expected: |
    {"foo":{"bar":["a","b"]}}
    {"bar":["a","b"]}
    ["a","b"]
    "a"
    "b"

- name: recurse after iterator
  args:
    - '.[] | ..'
  input: '{"foo":[{"bar":128}]}'
  expected: |
    [
      {
        "bar": 128
      }
    ]
    {
      "bar": 128
    }
    128

- name: recurse and pipe
  args:
    - '.. | .foo?'
  input: '{"foo":{"bar":["a","b"]}}'
  expected: |
    {
      "bar": [
        "a",
        "b"
      ]
    }
    null

- name: recurse in object value
  args:
    - -c
    - '{ foo: .. }'
  input: '{"foo":[1,2,3]}'
  expected: |
    {"foo":{"foo":[1,2,3]}}
    {"foo":[1,2,3]}
    {"foo":1}
    {"foo":2}
    {"foo":3}

- name: length function
  args:
    - -c
    - 'map(length),.'
  input: '[42, -42, {"a":1,"b":2}, [3,4,5], "Hello, world", "あいうえお", null, -4722366482869645213696]'
  expected: |
    [42,42,2,3,12,5,0,4722366482869645213696]
    [42,-42,{"a":1,"b":2},[3,4,5],"Hello, world","あいうえお",null,-4722366482869645213696]

- name: length function error
  args:
    - 'length'
  input: 'false'
  error: |
    length cannot be applied to: boolean (false)

- name: keys function
  args:
    - '[.[]|keys]'
  input: '[{"a":1,"b":2}, [3,4,5]]'
  expected: |
    [
      [
        "a",
        "b"
      ],
      [
        0,
        1,
        2
      ]
    ]

- name: utf8bytelength function
  args:
    - 'utf8bytelength'
  input: '"あいうえお☆ミ"'
  expected: |
    21

- name: has function on objects
  args:
    - 'map(has(.c[]))'
  input: '[{"a":{"b":1},"c":["a","b"]}, {"c":["b","c"]}]'
  expected: |
    [
      true,
      false,
      false,
      true
    ]

- name: has function on arrays
  args:
    - 'map(has(2))'
  input: '[[1, 2, 3], [1, 3]]'
  expected: |
    [
      true,
      false
    ]

- name: has/0 is not defined
  args:
    - 'map(has)'
  input: '[0]'
  error: |
    function not defined: has/0

- name: has/2 is not defined
  args:
    - 'map(has(1; 2))'
  input: '[0]'
  error: |
    function not defined: has/2

- name: has function type error
  args:
    - 'has(0)'
  input: '{}'
  error: |
    cannot check wether object ({}) has a key: number (0)

- name: in function for object
  args:
    - 'map(in({"foo": 42}))'
  input: '["foo", "bar"]'
  expected: |
    [
      true,
      false
    ]

- name: in function for array
  args:
    - 'map(in([3, 4]))'
  input: '[-1, 0, 1, 2]'
  expected: |
    [
      false,
      true,
      true,
      false
    ]

- name: in function type error
  args:
    - 'in([])'
  input: '"x"'
  error: |
    cannot check wether array ([]) has a key: string ("x")

- name: map function
  args:
    - -c
    - 'map(..)'
  input: '[{"a":{"b":1}}, [2,3,4]]'
  expected: |
    [{"a":{"b":1}},{"b":1},1,[2,3,4],2,3,4]

- name: to_entries function
  args:
    - -c
    - 'to_entries'
  input: '[10, 20] {"a": 10, "b": []}'
  expected: |
    [{"key":0,"value":10},{"key":1,"value":20}]
    [{"key":"a","value":10},{"key":"b","value":[]}]

- name: from_entries function
  args:
    - -c
    - 'from_entries'
  input: '[{"key":"a", "value":1}, {"Key":"b", "Value":2}, {"name":"c", "value":3}, {"Name":"d", "Value":4}]'
  expected: |
    {"a":1,"b":2,"c":3,"d":4}

- name: with_entries function
  args:
    - -c
    - 'with_entries(.key |= "x" + . | .value += 1)'
  input: '{"a": 1, "b": 2}'
  expected: |
    {"xa":2,"xb":3}

- name: add function
  args:
    - -c
    - 'map(add)'
  input: '[[], [1,2,3], ["a","b","c"], [[3],[4,5],[6]], [{"a":1}, {"b":2}, {"a":3}]]'
  expected: |
    [null,6,"abc",[3,4,5,6],{"a":3,"b":2}]

- name: flatten/0 function
  args:
    - -c
    - 'map(flatten)'
  input: '[[0, [[[[[1]]]]]], [0, [1, [2]], [1, [[3], 2]]]]'
  expected: |
    [[0,1],[0,1,2,1,3,2]]

- name: flatten/1 function
  args:
    - -c
    - 'map(flatten(2))'
  input: '[[0, [[[[[1]]]]]], [0, [1, [2]], [1, [[3], 2]]]]'
  expected: |
    [[0,[[[1]]]],[0,1,2,1,[3],2]]

- name: min, min_by, max, max_by functions
  args:
    - -c
    - '[min, min_by(.[1]), min_by(.[2]), max, max_by(.[1]), max_by(.[2])]'
  input: '[] [[4,2,"a"],[3,1,"a"],[2,4,"a"],[1,3,"a"]]'
  expected: |
    [null,null,null,null,null,null]
    [[1,3,"a"],[3,1,"a"],[4,2,"a"],[4,2,"a"],[2,4,"a"],[1,3,"a"]]

- name: sort, sort_by, group_by functions
  args:
    - -c
    - 'sort, sort_by(.a), sort_by(.b), sort_by(.b, .c), group_by(.b), group_by(.c, .a), group_by(.a + .b - .c == 2)'
  input: '[{"a": 1, "b": 4, "c": 5}, {"a": 4, "b": 1, "c": 2}, {"a": 1, "b": 4, "c": 3}, {"a": 3, "b": 2, "c": 1}]'
  expected: |
    [{"a":1,"b":4,"c":3},{"a":1,"b":4,"c":5},{"a":3,"b":2,"c":1},{"a":4,"b":1,"c":2}]
    [{"a":1,"b":4,"c":5},{"a":1,"b":4,"c":3},{"a":3,"b":2,"c":1},{"a":4,"b":1,"c":2}]
    [{"a":4,"b":1,"c":2},{"a":3,"b":2,"c":1},{"a":1,"b":4,"c":5},{"a":1,"b":4,"c":3}]
    [{"a":4,"b":1,"c":2},{"a":3,"b":2,"c":1},{"a":1,"b":4,"c":3},{"a":1,"b":4,"c":5}]
    [[{"a":4,"b":1,"c":2}],[{"a":3,"b":2,"c":1}],[{"a":1,"b":4,"c":5},{"a":1,"b":4,"c":3}]]
    [[{"a":3,"b":2,"c":1}],[{"a":4,"b":1,"c":2}],[{"a":1,"b":4,"c":3}],[{"a":1,"b":4,"c":5}]]
    [[{"a":1,"b":4,"c":5},{"a":4,"b":1,"c":2},{"a":3,"b":2,"c":1}],[{"a":1,"b":4,"c":3}]]

- name: unique, unique_by functions
  args:
    - -c
    - 'unique, unique_by(length)'
  input: '[7,3,5,1,4,2,5,3,6,1,7,4,3] ["cat", "dog", "hello", "world", "banana", "apple"]'
  expected: |
    [1,2,3,4,5,6,7]
    [1,2,3,4,5,6,7]
    ["apple","banana","cat","dog","hello","world"]
    ["cat","hello","banana"]

- name: arrays, objects, iterables, booleans, numbers, strings, nulls, values, scalars functions
  args:
    - -c
    - 'map(arrays), map(objects), map(iterables), map(booleans), map(numbers), map(strings), map(nulls), map(values), map(scalars)'
  input: '[null, true, false, 0, 1, "", "foo", [], [2, []], {}, { "foo": [] }, 4722366482869645213696]'
  expected: |
    [[],[2,[]]]
    [{},{"foo":[]}]
    [[],[2,[]],{},{"foo":[]}]
    [true,false]
    [0,1,4722366482869645213696]
    ["","foo"]
    [null]
    [true,false,0,1,"","foo",[],[2,[]],{},{"foo":[]},4722366482869645213696]
    [null,true,false,0,1,"","foo",4722366482869645213696]

- name: leaf_paths function
  args:
    - -c
    - 'leaf_paths'
  input: '[null,[],{},{"a":[1,[],{},true]},[3,[],1]]'
  expected: |
    [3,"a",0]
    [3,"a",3]
    [4,0]
    [4,2]

- name: recurse/0 function
  args:
    - -c
    - 'recurse'
  input: '{"a":{"b":[1]}}'
  expected: |
    {"a":{"b":[1]}}
    {"b":[1]}
    [1]
    1

- name: recurse/1 function
  args:
    - -c
    - 'recurse(.a[])'
  input: '{"a":[{"a": []}, {"a":[{"a":[]}]}]}'
  expected: |
    {"a":[{"a":[]},{"a":[{"a":[]}]}]}
    {"a":[]}
    {"a":[{"a":[]}]}
    {"a":[]}

- name: recurse/2 function
  args:
    - -c
    - '[recurse(. + .; . < 1000)]'
  input: '1'
  expected: |
    [1,2,4,8,16,32,64,128,256,512]

- name: while function
  args:
    - -c
    - '[while(.[0]<100; [.[1], .[0]+.[1]]) | .[0]]'
  input: '[0, 1]'
  expected: |
    [0,1,1,2,3,5,8,13,21,34,55,89]

- name: until function
  args:
    - '[.,1] | until(.[0]==0; [.[0]-1, .[0]*.[1]]) | .[1]'
  input: '20'
  expected: |
    2432902008176640000

- name: repeat function
  args:
    - -c
    - '[limit(.; repeat(1,2,3))]'
  input: '10'
  expected: |
    [1,2,3,1,2,3,1,2,3,1]

- name: range function
  args:
    - -c
    - '[range(.)], [range(. + 1)], [range(3; 5)], [range(0; 10; 3)], [range(0; 10; -1)], [range(5; -5; -3)]'
  input: '3'
  expected: |
    [0,1,2]
    [0,1,2,3]
    [3,4]
    [0,3,6,9]
    []
    [5,2,-1,-4]

- name: range function with iterators in argument
  args:
    - -c
    - '[range(-.; .+1)] | [range(.[]; .[]; .[])] | recurse(.[26:];.[0])|.[:26] | map(.+3)'
  input: '3'
  expected: |
    [0,0,0,0,1,0,0,0,1,2,0,2,0,0,1,2,3,0,2,0,3,0,1,2,3,4]
    [0,2,4,0,3,0,1,2,3,4,5,0,2,4,0,3,1,1,1,1,1,1,1,2,1,1]
    [1,2,3,1,3,1,1,2,3,4,1,3,1,4,1,2,3,4,5,1,3,5,1,4,2,2]
    [2,1,2,2,2,2,2,2,2,3,2,2,2,3,4,2,4,2,2,3,4,5,2,4,2,5]
    [3,3,1,3,2,1,3,3,3,2,3,3,3,3,3,3,3,4,3,3,3,4,5,3,5,3]
    [4,1,4,2,4,3,2,1,4,4,2,4,3,2,4,4,4,3,4,4,4,4,4,4,4,5]
    [4,4,5,2,5,3,1,5,4,3,2,1,5,2,5,3,5,4,3,2,5,5,3,5,4,3]
    [5,5,5,4,5,5,5,5,5,5,6,3,6,4,2,6,5,4,3,2,1,6,3,6,4,2]
    [6,5,4,3,2,6,3,6,4,6,5,4,3,6,6,4,6,5,4,6,6,6,5,6,6,6]

- name: tonumber function
  args:
    - 'map(tonumber)'
  input: '["0", "12345", "-43210", 3.14]'
  expected: |
    [
      0,
      12345,
      -43210,
      3.14
    ]

- name: tostring function
  args:
    - 'map(tostring)'
  input: '["foo bar", 3.14, {"foo": "-43210"}, false, [1,2,3]]'
  expected: |
    [
      "foo bar",
      "3.14",
      "{\"foo\":\"-43210\"}",
      "false",
      "[1,2,3]"
    ]

- name: type function
  args:
    - 'map(type)'
  input: '[null, false, true, 0, "foo", [], {}]'
  expected: |
    [
      "null",
      "boolean",
      "boolean",
      "number",
      "string",
      "array",
      "object"
    ]

- name: reverse function
  args:
    - 'reverse'
  input: '[0, 1, 2, 3, 4]'
  expected: |
    [
      4,
      3,
      2,
      1,
      0
    ]

- name: contains function
  args:
    - -c
    - '.[] as $x | (null,false,true,[],[3,4],[3,1],"foo","ll",{},{"a":1},{"b":[5]}) as $y | $x | [$x,$y,contains($y)]?'
  input: '[null,false,true,[],[1,2,3],"","hello",{"a":3,"b":[4,5,6]}]'
  expected: |
    [null,null,true]
    [false,false,true]
    [true,true,true]
    [[],[],true]
    [[],[3,4],false]
    [[],[3,1],false]
    [[1,2,3],[],true]
    [[1,2,3],[3,4],false]
    [[1,2,3],[3,1],true]
    ["","foo",false]
    ["","ll",false]
    ["hello","foo",false]
    ["hello","ll",true]
    [{"a":3,"b":[4,5,6]},{},true]
    [{"a":3,"b":[4,5,6]},{"a":1},false]
    [{"a":3,"b":[4,5,6]},{"b":[5]},true]

- name: contains function against unicode strings
  args:
    - -c
    - '. as $x | ("@", "\u0000@", "\u0000dc", "b\u0000c", "b\u0000cd", "b\u0000cd") as $y | $x | [$x,$y,contains($y)]'
  input: '"ab\u0000cd"'
  expected: |
    ["ab\u0000cd","@",false]
    ["ab\u0000cd","\u0000@",false]
    ["ab\u0000cd","\u0000dc",false]
    ["ab\u0000cd","b\u0000c",true]
    ["ab\u0000cd","b\u0000cd",true]
    ["ab\u0000cd","b\u0000cd",true]

- name: indices function for array
  args:
    - 'indices(1), indices([]), indices([1,2]), indices([3,4,5])'
  input: '[0, 1, 2, 3, 4, 3, 2, 1, 2, 1, 2, 3, 4]'
  expected: |
    [
      1,
      7,
      9
    ]
    []
    [
      1,
      7,
      9
    ]
    []

- name: indices function for string
  args:
    - 'indices(""), indices("ell"), indices("wor"), indices("ol"), indices("うえ")'
  input: '"hello, world, hello, word あいうえお"'
  expected: | # different from jq due to multibyte characters
    []
    [
      1,
      15
    ]
    [
      7,
      21
    ]
    []
    [
      28
    ]

- name: index, rindex functions
  args:
    - 'index(","), rindex(","), indices(",")'
  input: '"a,bc,def,ghij,klmno"'
  expected: |
    1
    13
    [
      1,
      4,
      8,
      13
    ]

- name: inside function
  args:
    - -c
    - '.[] as $x | (false,"abc",[],["foobaz","foobar"],{},{"a":10,"b":20,"c":30}) as $y | $x | [$x,$y,inside($y)]?'
  input: '["a",["bar","baz"],{"a":10,"b":20}]'
  expected: |
    ["a","abc",true]
    [["bar","baz"],[],false]
    [["bar","baz"],["foobaz","foobar"],true]
    [{"a":10,"b":20},{},false]
    [{"a":10,"b":20},{"a":10,"b":20,"c":30},true]

- name: startswith function
  args:
    - 'map(startswith("foo"))'
  input: '["", "fo", "foo", "fooo", "barfoo"]'
  expected: |
    [
      false,
      false,
      true,
      true,
      false
    ]

- name: endswith function
  args:
    - 'map(endswith("foo"))'
  input: '["", "fo", "foo", "fooo", "barfoo"]'
  expected: |
    [
      false,
      false,
      true,
      false,
      true
    ]

- name: ltrimstr function
  args:
    - 'map(ltrimstr("foo"))'
  input: '["", "fo", "foo", "fooo", "barfoo"]'
  expected: |
    [
      "",
      "fo",
      "",
      "o",
      "barfoo"
    ]

- name: rtrimstr function
  args:
    - 'map(rtrimstr("foo"))'
  input: '["", "fo", "foo", "fooo", "barfoo"]'
  expected: |
    [
      "",
      "fo",
      "",
      "fooo",
      "bar"
    ]

- name: combinations/0 function
  args:
    - -c
    - '[combinations]'
  input: '[[1, 2, 3], [4, 5, 6]]'
  expected: |
    [[1,4],[1,5],[1,6],[2,4],[2,5],[2,6],[3,4],[3,5],[3,6]]

- name: combinations/1 function
  args:
    - -c
    - '[combinations(3)]'
  input: '[0, 1]'
  expected: |
    [[0,0,0],[0,0,1],[0,1,0],[0,1,1],[1,0,0],[1,0,1],[1,1,0],[1,1,1]]

- name: join function
  args:
    - 'join(",")'
  input: '[null, false, true, 0, 1, "", "a", "b", "abc"]'
  expected: |
    ",false,true,0,1,,a,b,abc"

- name: join function with iterator argument
  args:
    - '. / "" | join(.[])'
  input: '"abcde"'
  expected: |
    "aabacadae"
    "abbbcbdbe"
    "acbcccdce"
    "adbdcddde"
    "aebecedee"

- name: join function error
  args:
    - 'try join(",") catch .'
  input: '["1","2",[3,4,5]]'
  expected: |
    "cannot add: string (\"1,2,\") and array ([3,4,5])"

- name: ascii_downcase function
  args:
    - 'ascii_downcase'
  input: '"@ABC XYZ[] `abc xyz{} ☆"'
  expected: |
    "@abc xyz[] `abc xyz{} ☆"

- name: ascii_upcase function
  args:
    - 'ascii_upcase'
  input: '"@ABC XYZ[] `abc xyz{} ☆"'
  expected: |
    "@ABC XYZ[] `ABC XYZ{} ☆"

- name: walk function
  args:
    - -c
    - 'walk(if type == "boolean" then not else . + . end) | .[]'
  input: '[1, ["a", {"b": []}], {"c": [null, false, true]}]'
  expected: |
    2
    ["aa",{"b":[]},"aa",{"b":[]}]
    {"c":[null,true,false,null,true,false]}
    2
    ["aa",{"b":[]},"aa",{"b":[]}]
    {"c":[null,true,false,null,true,false]}

- name: transpose function
  args:
    - -c
    - 'transpose'
  input: '[] [[1,2,3,[]],[4,"foo",{}],[5,6]]'
  expected: |
    []
    [[1,4,5],[2,"foo",6],[3,{},null],[[],null,null]]

- name: function not defined
  args:
    - 'abc'
  input: '{}'
  error: |
    function not defined: abc/0

- name: variable not defined
  args:
    - '$abc'
  input: '{}'
  error: |
    variable not defined: $abc

- name: argument count error
  args:
    - 'map(.;.)'
  input: '{}'
  error: |
    function not defined: map/2

- name: function declaration
  args:
    - 'def f(g): g | g; f(..)'
  input: '[0, 1]'
  expected: |
    [
      0,
      1
    ]
    0
    1
    0
    1

- name: function declaration
  args:
    - -c
    - 'def f: def g: .; g; f'
  input: '[0, 1]'
  expected: |
    [0,1]

- name: function declaration
  args:
    - -c
    - 'def f: .,.; def g: [f,f]; f,g'
  input: '[0, 1]'
  expected: |
    [0,1]
    [0,1]
    [[0,1],[0,1],[0,1],[0,1]]

- name: function declaration and recursive call
  args:
    - 'def f(g): if type == "array" then map(f(g * 2)) else g end; f(.)'
  input: '[[[1,2]]]'
  expected: |
    [
      [
        [
          8,
          16
        ]
      ]
    ]

- name: function declaration and recursive call
  args:
    - 'def f(g): if . < 1000 then .,(g|f(g|g)) else g end; f(.*2)'
  input: '1'
  expected: |
    1
    2
    8
    128
    2147483648

- name: function declaration with duplicate function names
  args:
    - 'def f(g): def f: def g: 3; g * 2; g * f; def f: . * 5; f(f)'
  input: '1'
  expected: |
    30

- name: function declaration with duplicate argument names
  args:
    - 'def f(g;g): g; f(1;2)'
  input: 'null'
  expected: |
    2

- name: function declaration with duplicate variable names
  args:
    - 'def f($g;$g): $g; f(1;2)'
  input: 'null'
  expected: |
    2

- name: function declaration with mixed argument types
  args:
    - -c
    - 'def f0( a; b; c):  a*100 +  b*10 +  c;
       def f1( a;$b; c):  a*100 + $b*10 +  c;
       def f2($a; b;$c): $a*100 +  b*10 + $c;
       def f3($a;$b;$c): $a*100 + $b*10 + $c;
       [f0(.[];.[];.[])], [f1(.[];.[];.[])], [f2(.[];.[];.[])], [f3(.[];.[];.[])]'
  input: '[1,2]'
  expected: |
    [111,211,121,221,112,212,122,222]
    [111,211,112,212,121,221,122,222]
    [111,121,112,122,211,221,212,222]
    [111,112,121,122,211,212,221,222]

- name: function declaration inside query
  args:
    - -c
    - '[0, def f: 1, def g: 2; g, 3 as $x | def h: $x + 1; h * g; f, f + 1, 5]'
  input: 'null'
  expected: |
    [0,1,2,8,2,3,9,5]

- name: argument count error for custom function
  args:
    - 'def f(g): g | g; f'
  input: '{}'
  error: |
    function not defined: f/0

- name: add, subtract, multiply, divide, modulo numbers
  args:
    - -c
    - '[.[] + .[] % .[] * .[] - .[] / .[]] | while(length>0; .[8:]) | .[:8]'
  input: '[5, 16]'
  expected: |
    [4,15,9,20,29,40,4,15]
    [4,15,20,31,84,95,4,15]
    [1.7999999999999998,12.8,6.8,17.8,26.8,37.8,1.7999999999999998,12.8]
    [1.7999999999999998,12.8,17.8,28.8,81.8,92.8,1.7999999999999998,12.8]
    [4.6875,15.6875,9.6875,20.6875,29.6875,40.6875,4.6875,15.6875]
    [4.6875,15.6875,20.6875,31.6875,84.6875,95.6875,4.6875,15.6875]
    [4,15,9,20,29,40,4,15]
    [4,15,20,31,84,95,4,15]

- name: add, subtract, multiply, divide, modulo large numbers
  args:
    - -c
    - '[.[] + .[]], [.[] - .[]], [.[] * .[]], [.[] / .[]], [.[]  % .[]]'
  input: '[47, 4722366482869645213696, 557702036893939360447070208]'
  expected: |
    [94,4722366482869645213743,557702036893939360447070255,4722366482869645213743,9444732965739290427392,557706759260422230092283904,557702036893939360447070255,557706759260422230092283904,1115404073787878720894140416]
    [0,4722366482869645213649,557702036893939360447070161,-4722366482869645213649,0,557697314527456490801856512,-557702036893939360447070161,-557697314527456490801856512,0]
    [2209,221951224694873325043712,26211995734015149941012299776,221951224694873325043712,22300745198530623141535718272648361505980416,2633673406456069531769085256563226197133275168768,26211995734015149941012299776,2633673406456069531769085256563226197133275168768,311031561955648899562865430629603887429045530881163264]
    [1,100475882614247770000,1.1866000784977433e+25,9.952637130238029e-21,1,118098,8.427439186301232e-26,0.000008467543904215143,1]
    [0,8,37,47,0,0,47,4722366482869645213696,0]

- name: factorial calculation
  args:
    - -n
    - -r
    - 'def fact($n): if $n < 1 then 1 else $n * fact($n - 1) end; (range(30;51) | "\(.)! = \(fact(.))"), fact(50) / fact(30), fact(50) % (fact(30) + 1), fact(100), fact(1000)*1.0, 1/fact(1000), 1.0/fact(1000)'
  expected: |
    30! = 265252859812191058636308480000000
    31! = 8222838654177922817725562880000000
    32! = 263130836933693530167218012160000000
    33! = 8683317618811886495518194401280000000
    34! = 295232799039604140847618609643520000000
    35! = 10333147966386144929666651337523200000000
    36! = 371993326789901217467999448150835200000000
    37! = 13763753091226345046315979581580902400000000
    38! = 523022617466601111760007224100074291200000000
    39! = 20397882081197443358640281739902897356800000000
    40! = 815915283247897734345611269596115894272000000000
    41! = 33452526613163807108170062053440751665152000000000
    42! = 1405006117752879898543142606244511569936384000000000
    43! = 60415263063373835637355132068513997507264512000000000
    44! = 2658271574788448768043625811014615890319638528000000000
    45! = 119622220865480194561963161495657715064383733760000000000
    46! = 5502622159812088949850305428800254892961651752960000000000
    47! = 258623241511168180642964355153611979969197632389120000000000
    48! = 12413915592536072670862289047373375038521486354677760000000000
    49! = 608281864034267560872252163321295376887552831379210240000000000
    50! = 30414093201713378043612608166064768844377641568960512000000000000
    114660755112113373922453094400000
    150592104700077684713855385600001
    93326215443944152681699238856266700490715968264381621468592963895217599993229915608941463976156518286253697920827223758251185210916864000000000000000000000000
    1.7976931348623157e+308
    0
    5.562684646268003e-309

- name: negative large numbers
  args:
    - -n
    - 'def f($n): if $n < 1 then 1 else (-$n) * (-f($n - 1)) end; -f(range(30;40))'
  expected: |
    -265252859812191058636308480000000
    -8222838654177922817725562880000000
    -263130836933693530167218012160000000
    -8683317618811886495518194401280000000
    -295232799039604140847618609643520000000
    -10333147966386144929666651337523200000000
    -371993326789901217467999448150835200000000
    -13763753091226345046315979581580902400000000
    -523022617466601111760007224100074291200000000
    -20397882081197443358640281739902897356800000000

- name: large number literal
  args:
    - -n
    - |
      100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000,
      -100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000,
      100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000.0,
      -100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000.0,
      10000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000,
      -10000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000,
      10000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000.0,
      -10000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000.0
  expected: |
    100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    -100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    1e+308
    -1e+308
    10000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    -10000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    1.7976931348623157e+308
    -1.7976931348623157e+308

- name: zero division
  args:
    - '.[] / .[]'
  input: '[1, 0]'
  expected: |
    1
    0
  error: |
    cannot divide number (1) by: number (0)

- name: zero modulo
  args:
    - '.[] % .[]'
  input: '[1, 0]'
  expected: |
    0
    0
  error: |
    cannot modulo number (1) by: number (0)

- name: zero division and modulo for large number
  args:
    - -c
    - '[try .[] / .[] catch .], [try .[] % .[] catch .]'
  input: '[1267650600228229401496703205376, 0]'
  expected: |
    [1,0,"cannot divide number (1267650600228229401496 ...) by: number (0)"]
    [0,0,"cannot modulo number (1267650600228229401496 ...) by: number (0)"]

- name: add strings
  args:
    - '.[] + .[] + "c"'
  input: '["a", "b"]'
  expected: |
    "aac"
    "bac"
    "abc"
    "bbc"

- name: multiply constant
  args:
    - '3 * .[], 2.5 * .[], .054e2 * .[]'
  input: '[1, 2.5, "abc"]'
  expected: |
    3
    7.5
    "abcabcabc"
    2.5
    6.25
    "abcabc"
    5.4
    13.5
    "abcabcabcabcabc"

- name: multiply strings
  args:
    - '[-1.0, -0.5, 0.0, 0.5, 1.0, 1.5, 3.7, 10, 9444732965739290427392 / 4722366482869645213696][] * "abc"'
  input: 'null'
  expected: |
    null
    null
    null
    "abc"
    "abc"
    "abc"
    "abcabcabc"
    "abcabcabcabcabcabcabcabcabcabc"
    "abcabc"

- name: multiply objects
  args:
    - -c
    - '.[] * .[]'
  input: '[{"foo": 10, "bar": {"qux": 20}}, {"foo": 20, "bar": {"baz": "quux"}}]'
  expected: |
    {"bar":{"qux":20},"foo":10}
    {"bar":{"baz":"quux","qux":20},"foo":10}
    {"bar":{"baz":"quux","qux":20},"foo":20}
    {"bar":{"baz":"quux"},"foo":20}

- name: divide strings
  args:
    - -c
    - '.[] / .[]'
  input: '["abc", "a", "b"]'
  expected: |
    ["",""]
    ["a"]
    ["b"]
    ["","bc"]
    ["",""]
    ["b"]
    ["a","c"]
    ["a"]
    ["",""]

- name: add and subtract arrays
  args:
    - -c
    - '.[] + .[] - .[]'
  input: '[[1, 2], [3, 4]]'
  expected: |
    []
    [3,4]
    [3,4]
    [3,4,3,4]
    [1,2,1,2]
    [1,2]
    [1,2]
    []

- name: subtract arrays
  args:
    - -c
    - '[1,2,3,4,1,4722366482869645213696] - [.,3,4722366482869645213696]'
  input: '1'
  expected: |
    [2,4]

- name: add object
  args:
    - -c
    - '.[] + .[]'
  input: '[{"a":1},{"b":2}]'
  expected: |
    {"a":1}
    {"a":1,"b":2}
    {"a":1,"b":2}
    {"b":2}

- name: add null
  args:
    - '.[] + .[]'
  input: '[1, 2, null]'
  expected: |
    2
    3
    1
    3
    4
    2
    1
    2
    null

- name: subtract null
  args:
    - '.[] - .[]'
  input: '[1, 2, null]'
  expected: |
    0
    1
  error: |
    cannot subtract: null and number (1)

- name: subtract object
  args:
    - '.[] - .[]'
  input: '[{"a":1},{"b":2}]'
  error: |
    cannot subtract: object ({"a":1}) and object ({"a":1})

- name: comparison operators
  args:
    - '[.[] > .[], .[] < .[], .[] >= .[], .[] <= .[], .[] == .[], .[] != .[]] | while(length>0; .[120:]) | .[:120] | map(if . then 1 else 0 end) | join("")'
  input: '[null, false, true, 0, 1, "", "a", "b", "abc", [], [1], [2], [3, 4], ["a", "b"], [[]], [[], []], [{}], {}, {"a": ""}, {"a":[1]}, {"b":[1]}, {"b": []}, {"b": [[]]}, {"a": 0, "b": 1}]'
  expected: |
    "011111111111111111111111001111111111111111111111000111111111111111111111000011111111111111111111000001111111111111111111"
    "000000111111111111111111000000011111111111111111000000000111111111111111000000010111111111111111000000000011111111111111"
    "000000000001111111111111000000000000111111111111000000000000011111111111000000000000001111111111000000000000000111111111"
    "000000000000000011111111000000000000000001111111000000000000000000111111000000000000000000011111000000000000000000001111"
    "000000000000000000000010000000000000000000001010000000000000000000000000000000000000000000001110000000000000000000000000"
    "100000000000000000000000110000000000000000000000111000000000000000000000111100000000000000000000111110000000000000000000"
    "111111000000000000000000111111101000000000000000111111100000000000000000111111111000000000000000111111111100000000000000"
    "111111111110000000000000111111111111000000000000111111111111100000000000111111111111110000000000111111111111111000000000"
    "111111111111111100000000111111111111111110000000111111111111111111000000111111111111111111100000111111111111111111110101"
    "111111111111111111110001111111111111111111111101111111111111111111110000111111111111111111111111011111111111111111111111"
    "001111111111111111111111000111111111111111111111000011111111111111111111000001111111111111111111000000111111111111111111"
    "000000010111111111111111000000011111111111111111000000000111111111111111000000000011111111111111000000000001111111111111"
    "000000000000111111111111000000000000011111111111000000000000001111111111000000000000000111111111000000000000000011111111"
    "000000000000000001111111000000000000000000111111000000000000000000011111000000000000000000001010000000000000000000001110"
    "000000000000000000000010000000000000000000001111100000000000000000000000110000000000000000000000111000000000000000000000"
    "111100000000000000000000111110000000000000000000111111000000000000000000111111100000000000000000111111111000000000000000"
    "111111101000000000000000111111111100000000000000111111111110000000000000111111111111000000000000111111111111100000000000"
    "111111111111110000000000111111111111111000000000111111111111111100000000111111111111111110000000111111111111111111000000"
    "111111111111111111100000111111111111111111110000111111111111111111111101111111111111111111110101111111111111111111111111"
    "111111111111111111110001100000000000000000000000010000000000000000000000001000000000000000000000000100000000000000000000"
    "000010000000000000000000000001000000000000000000000000100000000000000000000000010000000000000000000000001000000000000000"
    "000000000100000000000000000000000010000000000000000000000001000000000000000000000000100000000000000000000000010000000000"
    "000000000000001000000000000000000000000100000000000000000000000010000000000000000000000001000000000000000000000000100000"
    "000000000000000000010000000000000000000000001000000000000000000000000100000000000000000000000010000000000000000000000001"
    "011111111111111111111111101111111111111111111111110111111111111111111111111011111111111111111111111101111111111111111111"
    "111110111111111111111111111111011111111111111111111111101111111111111111111111110111111111111111111111111011111111111111"
    "111111111101111111111111111111111110111111111111111111111111011111111111111111111111101111111111111111111111110111111111"
    "111111111111111011111111111111111111111101111111111111111111111110111111111111111111111111011111111111111111111111101111"
    "111111111111111111110111111111111111111111111011111111111111111111111101111111111111111111111110"

- name: comparison and arithmetic operators
  args:
    - '[.[] + .[] > .[] - .[], .[] * .[] < .[] / .[] + .[] / .[], .[] == .[] * .[]] | while(length>0; .[120:]) | .[:120] | map(if . then 1 else 0 end) | join("")'
  input: '[1, 2, 3]'
  expected: |
    "111111111111111111011111111111111111111111111111111111111111111111111111111111111100000000110100000111100100100000000100"
    "000000110100000100000000100000000100000000110100000111100100111110100110100000110100000111100100110100000110100000110100"
    "000111100100111110100111110100111100100111100100111110100111100100111100100111100100100000000110100000111100100000000000"
    "100000000100000000000000000100000000100000000100000000110100000111100100100000000100000000110100000100000000100000000100"
    "000000110100000111100100111110100100000000110100000110100000100000000110100000110100000100000000110100000111100100000000"
    "000100000000100000000000000000000000000100000000100000000110100000111100100100000000100000000110100000000000000100000000"
    "100000000100000000110100000111100100100000000100000000110100000100000000100000000100000000100010001010000000001000000"

- name: comparison operators with large numbers
  args:
    - '[.[] > .[], .[] < .[], .[] >= .[], .[] <= .[], .[] == .[], .[] != .[]] | while(length>0; .[120:]) | .[:120] | map(if . then 1 else 0 end) | join("")'
  input: '[-9999999999999999999999999999999999, -4722366482869645213697, -2, 0, 47, 4722366482869645213696, 4722366482869645213697, 99999999999999999999999999999999999]'
  expected: |
    "011111110011111100011111000011110000011100000011000000010000000000000000100000001100000011100000111100001111100011111100"
    "111111101111111101111111001111110001111100001111000001110000001100000001100000001100000011100000111100001111100011111100"
    "111111101111111110000000010000000010000000010000000010000000010000000010000000010111111110111111110111111110111111110111"
    "111110111111110111111110"

- name: comparison operators does not associate
  args:
    - '. == . == .'
  input: '1'
  error: |
    invalid query: . == . == .
        . == . == .
               ^  unexpected token "=="

- name: logical operators
  args:
    - '[.[] > .[] and .[] or .[] < .[]] | while(length>0; .[120:]) | .[:120] | map(if . then 1 else 0 end) | join("")'
  input: '[null, false, true, 0, "", [], {}]'
  expected: |
    "000000010000001100000111000011110001111100111111000000001000000110000011100001111000111110011111100000000100000011000001"
    "110000111100011111001111110111110000000100000011000001110000111100011111001111110000000010000001100000111000011110001111"
    "100111111011111000000010000001100000111000011110001111100111111000000001000000110000011100001111000111110011111101111100"
    "000001000000110000011100001111000111110011111100000000100000011000001110000111100011111001111110111110000000100000011000"
    "001110000111100011111001111110000000010000001100000111000011110001111100111111011111000000010000001100000111000011110001"
    "111100111111000000001000000110000011100001111000111110011111101111100000001000000110000011100001111000111110011111100000"
    "000100000011000001110000111100011111001111110000000010000001100000111000011110001111100111111000000001000000110000011100"
    "001111000111110011111101111100000001000000110000011100001111000111110011111100000000100000011000001110000111100011111001"
    "111110111110000000100000011000001110000111100011111001111110000000010000001100000111000011110001111100111111011111000000"
    "010000001100000111000011110001111100111111000000001000000110000011100001111000111110011111101111100000001000000110000011"
    "100001111000111110011111100000000100000011000001110000111100011111001111110111110000000100000011000001110000111100011111"
    "001111110000000010000001100000111000011110001111100111111000000001000000110000011100001111000111110011111100000000100000"
    "011000001110000111100011111001111110000000010000001100000111000011110001111100111111011111000000010000001100000111000011"
    "110001111100111111000000001000000110000011100001111000111110011111101111100000001000000110000011100001111000111110011111"
    "100000000100000011000001110000111100011111001111110111110000000100000011000001110000111100011111001111110000000010000001"
    "100000111000011110001111100111111011111000000010000001100000111000011110001111100111111000000001000000110000011100001111"
    "000111110011111100000000100000011000001110000111100011111001111110000000010000001100000111000011110001111100111111000000"
    "001000000110000011100001111000111110011111100000000100000011000001110000111100011111001111110111110000000100000011000001"
    "110000111100011111001111110000000010000001100000111000011110001111100111111011111000000010000001100000111000011110001111"
    "100111111000000001000000110000011100001111000111110011111101111100000001000000110000011100001111000111110011111100000000"
    "100000011000001110000111100011111001111110000000010000001100000111000011110001111100111111000000001000000110000011100001"
    "111000111110011111100000000100000011000001110000111100011111001111110000000010000001100000111000011110001111100111111000"
    "000001000000110000011100001111000111110011111101111100000001000000110000011100001111000111110011111100000000100000011000"
    "001110000111100011111001111110111110000000100000011000001110000111100011111001111110000000010000001100000111000011110001"
    "111100111111000000001000000110000011100001111000111110011111100000000100000011000001110000111100011111001111110000000010"
    "000001100000111000011110001111100111111000000001000000110000011100001111000111110011111100000000100000011000001110000111"
    "100011111001111110000000010000001100000111000011110001111100111111011111000000010000001100000111000011110001111100111111"
    "000000001000000110000011100001111000111110011111100000000100000011000001110000111100011111001111110000000010000001100000"
    "111000011110001111100111111000000001000000110000011100001111000111110011111100000000100000011000001110000111100011111001"
    "1111100000000100000011000001110000111100011111001111110"

- name: alternative operator
  args:
    - -c
    - '[.a // .b, .b // null // .a, .c[] // .d[], .d[] // .c, .c // .a, .e.a // .c[]]'
  input: '{ "a": 5, "b": false, "c": [null,false], "d": [false,3], "e": null }'
  expected: |
    [5,5,false,3,3,[null,false],null,false]

- name: explode function
  args:
    - -c
    - 'map(explode)'
  input: '["", "foo bar", "あいうえお", "\n\t"]'
  expected: |
    [[],[102,111,111,32,98,97,114],[12354,12356,12358,12360,12362],[10,9]]

- name: implode function
  args:
    - -c
    - 'map(implode)'
  input: '[[],[102,111,111,32,98,97,114],[12354,12356,12358,12360,12362],[10,9]]'
  expected: |
    ["","foo bar","あいうえお","\n\t"]

- name: split/1 function
  args:
    - 'map(split(", ","") | join("/"))'
  input: '["a,b, c, d, e,f",", a,b, c, d, e,f, "]'
  expected: |
    [
      "a,b/c/d/e,f",
      "a/,/b/,/ /c/,/ /d/,/ /e/,/f",
      "/a,b/c/d/e,f/",
      ",/ /a/,/b/,/ /c/,/ /d/,/ /e/,/f/,/ "
    ]

- name: condition
  args:
    - '.[] | if . then . else empty end'
  input: '[false, true, 0, 1]'
  expected: |
    true
    0
    1

- name: condition with elif
  args:
    - '.[] | if . then . elif [] then . else empty end'
  input: '[false, true, 0, 1]'
  expected: |
    false
    true
    0
    1

- name: condition without else clause
  args:
    - 'map(if . > 2 then . / 2 end)'
  input: '[1, 2, 3, 4, 5]'
  expected: |
    [
      1,
      2,
      1.5,
      2,
      2.5
    ]

- name: condition precedence
  args:
    - '. + if 1 then 2 else 3 end + 4'
  input: '1'
  expected: |
    7

- name: not function
  args:
    - 'map(not)'
  input: '[true, false]'
  expected: |
    [
      false,
      true
    ]

- name: iterator in condition
  args:
    - 'if .. then [] else {} end'
  input: '{ "foo": false }'
  expected: |
    []
    {}

- name: try
  args:
    - 'map(try utf8bytelength)'
  input: '[[], {}, [1,2], "hello", 55, true, false]'
  expected: |
    [
      5
    ]

- name: try catch
  args:
    - 'map(try utf8bytelength catch .)'
  input: '[[], {}, [1,2], "hello", 55, true, false]'
  expected: |
    [
      "utf8bytelength cannot be applied to: array ([])",
      "utf8bytelength cannot be applied to: object ({})",
      "utf8bytelength cannot be applied to: array ([1,2])",
      5,
      "utf8bytelength cannot be applied to: number (55)",
      "utf8bytelength cannot be applied to: boolean (true)",
      "utf8bytelength cannot be applied to: boolean (false)"
    ]

- name: try precedence
  args:
    - '1 + try 2 catch 3 + 4'
  input: '1'
  expected: |
    7

- name: reduce iterator
  args:
    - '[range(.)] | reduce .[] as $i (0; . + $i)'
  input: '10'
  expected: |
    45

- name: reduce arrays
  args:
    - 'reduce .[] as [$i,$j] (0; . + $i * $j)'
  input: '[[1,2,10], [3,4,10]]'
  expected: |
    14

- name: reduce objects
  args:
    - 'reduce .[] as {$i, j:$j} (0; . + $i - $j)'
  input: '[{"i":2, "j":1}, {"i":5, "j":3}, {"i":6, "j":4}]'
  expected: |
    5

- name: reduce null
  args:
    - 'reduce . as $n (.; .)'
  input: 'null'
  expected: |
    null

- name: reduce precedence
  args:
    - '. + reduce . as $n (. + [2]; [.]) + .'
  input: '[1]'
  expected: |
    [
      1,
      [
        1,
        2
      ],
      1
    ]

- name: foreach iterator
  args:
    - 'foreach range(5) as $item (0; $item)'
  input: 'null'
  expected: |
    0
    1
    2
    3
    4

- name: foreach arrays
  args:
    - 'foreach .[] as [$i, $j] (0; . + $i - $j)'
  input: '[[2,1], [5,3], [6,4]]'
  expected: |
    1
    3
    5

- name: foreach objects
  args:
    - 'foreach .[] as {a:$a} (0; . + $a; -.)'
  input: '[{"a":1}, {"b":2}, {"a":3, "b":4}]'
  expected: |
    -1
    -1
    -4

- name: foreach with iterator in update
  args:
    - 'foreach .[] as $i (1; ., . + $i, range(.))'
  input: '[1, 2, 3]'
  expected: |
    1
    2
    0
    0
    2
    2
    5
    0
    1

- name: label and break syntax
  args:
    - '[(label $x | .[] | if . > 2 then break $x else . end), 0]'
  input: '[1,2,3,2,1]'
  expected: |
    [
      1,
      2,
      0
    ]

- name: label and break in foreach syntax
  args:
    - '[range(.)] | label $x | foreach .[] as $i (0; if . > 5 then break $x else . + $i end)'
  input: '10'
  expected: |
    0
    1
    3
    6

- name: invalid label name
  args:
    - 'label foo | .'
  input: '1'
  error: |
    label should start with "$" but got: "foo"

- name: label not defined error for break syntax
  args:
    - 'break $test'
  input: '1'
  error: |
    label not defined: "$test"

- name: string interpolation
  args:
    - -c
    - '["\(.foo[])_\(.bar[])_\(.baz[])"]'
  input: '{ "foo": [0, 1], "bar": ["x", "y"], "baz": [{"a": 1}, [1], null] }'
  expected: |
    ["0_x_{\"a\":1}","1_x_{\"a\":1}","0_y_{\"a\":1}","1_y_{\"a\":1}","0_x_[1]","1_x_[1]","0_y_[1]","1_y_[1]","0_x_null","1_x_null","0_y_null","1_y_null"]

- name: string interpolation in object
  args:
    - -c
    - '[{a:"\(.foo[])"}, {"\(.foo[])": 1}, {"\(.bar[])"}]'
  input: '{ "foo": [0, 1], "bar": ["x", "y"], "x": 10, "y": 20 }'
  expected: |
    [{"a":"0"},{"a":"1"},{"0":1},{"1":1},{"x":10},{"y":20}]

- name: tojson function
  args:
    - 'map(tojson)'
  input: '[1, null, false, "foo", ["foo"], {"a": [1,2,3]}]'
  expected: |
    [
      "1",
      "null",
      "false",
      "\"foo\"",
      "[\"foo\"]",
      "{\"a\":[1,2,3]}"
    ]

- name: fromjson function
  args:
    - 'map(fromjson)'
  input: '["1", "null", "false", "\"foo\"", "[\"foo\"]", "{\"a\":[1,2,3]}"]'
  expected: |
    [
      1,
      null,
      false,
      "foo",
      [
        "foo"
      ],
      {
        "a": [
          1,
          2,
          3
        ]
      }
    ]

- name: defining variable
  args:
    - '.foo.bar as $foo | .foo.bar as $bar | {$foo} + {bar: ($bar / 2)} * { baz: 20 }'
  input: '{ "foo": { "bar": 10 } }'
  expected: |
    {
      "bar": 5,
      "baz": 20,
      "foo": 10
    }

- name: defining variable
  args:
    - '.ys as $ys | .xs[] | {a, b: $ys[.b]}'
  input: '{"xs": [{"a": "a0", "b": "b0"}, {"a": "a1", "b": "b1"}], "ys": {"b0": "bb0", "b1": "bb1"}}'
  expected: |
    {
      "a": "a0",
      "b": "bb0"
    }
    {
      "a": "a1",
      "b": "bb1"
    }

- name: variable name error
  args:
    - '.foo as foo | {$bar}'
  input: '{ "foo": 10 }'
  error: |
    variable should start with "$" but got: "foo"

- name: variable name not found error
  args:
    - '.foo as $foo | {$bar}'
  input: '{ "foo": 10 }'
  error: |
    variable not defined: $bar

- name: binding an array
  args:
    - '. as [$i, $j] | [$j, $i]'
  input: '[] [10] [20, 30]'
  expected: |
    [
      null,
      null
    ]
    [
      null,
      10
    ]
    [
      30,
      20
    ]

- name: binding an array deeply
  args:
    - '. as [$i, [$j], [[$k]]] | [$i, $j, $k]'
  input: '[] [10] [20, [30], [[40]]]'
  expected: |
    [
      null,
      null,
      null
    ]
    [
      10,
      null,
      null
    ]
    [
      20,
      30,
      40
    ]

- name: binding an array error
  args:
    - '. as [$i, $j] | [$j, $i]'
  input: '{ "foo": 10 }'
  error: |
    expected an array but got: object ({"foo":10})

- name: binding an object
  args:
    - '. as {$foo, bar: $bar} | {$bar, $foo}'
  input: '{} {"foo": 10} {"foo": 20, "bar": 30}'
  expected: |
    {
      "bar": null,
      "foo": null
    }
    {
      "bar": null,
      "foo": 10
    }
    {
      "bar": 30,
      "foo": 20
    }

- name: binding an object deeply
  args:
    - '. as {$foo, bar: {baz: {$qux}}} | {$foo, $qux}'
  input: '{} {"foo": 10} {"foo": 20, "bar": { "baz": { "qux": 30 } } }'
  expected: |
    {
      "foo": null,
      "qux": null
    }
    {
      "foo": 10,
      "qux": null
    }
    {
      "foo": 20,
      "qux": 30
    }

- name: binding an object with expression
  args:
    - '. as {as: $foo, ("e"+"x"+"p"): $bar, (.foo): $baz} | [$foo, $bar, $baz]'
  input: '{"as": 1, "exp": 2, "foo": "bar", "bar": 3}'
  expected: |
    [
      1,
      2,
      3
    ]

- name: binding an object error
  args:
    - '. as {$i} | [$i]'
  input: '[10]'
  error: |
    expected an object but got: array ([10])

- name: binding object and array deeply
  args:
    - '. as {$a, $b: [$c, $d]} | [$a, $b, $c, $d]'
  input: '{"a":1, "b": [2, {"d": 3}]}'
  expected: |
    [
      1,
      [
        2,
        {
          "d": 3
        }
      ],
      2,
      {
        "d": 3
      }
    ]

- name: first/0, last/0 functions
  args:
    - -c
    - '[first, last]'
  input: '[1,2,3,4,5]'
  expected: |
    [1,5]

- name: first/1, last/1, nth functions
  args:
    - -c
    - '[first(.[]), last(.[]), nth(0), nth(3), nth(0;.[]), nth(3;.[])]'
  input: '[1,2,3,4,5]'
  expected: |
    [1,5,1,4,1,4]

- name: limit/2 function
  args:
    - -c
    - '[limit(0,3,13; range(10000000000000))]'
  input: 'null'
  expected: |
    [0,1,2,0,1,2,3,4,5,6,7,8,9,10,11,12]

- name: all/0, any/0 functions
  args:
    - -c
    - '[all, any]'
  input: '[] [false, false] [false, true] [true, true]'
  expected: |
    [true,false]
    [false,false]
    [false,true]
    [true,true]

- name: all/1, any/1 functions
  args:
    - -c
    - '[all(not), any(not)]'
  input: '[] [false, false] [false, true] [true, true]'
  expected: |
    [true,false]
    [true,true]
    [false,true]
    [false,false]

- name: all/2, any/2 functions
  args:
    - -c
    - '[all(range(.); not), any(range(.); not)]'
  input: '0 1'
  expected: |
    [true,false]
    [false,false]

- name: isempty function
  args:
    - -c
    - '[isempty(empty), isempty(range(10000000000000)), isempty(1,error("foo"))]'
  input: 'null'
  expected: |
    [true,false,false]

- name: trigonometric functions
  args:
    - -c
    - 'map(sin),map(cos),map(tan) | map(. * 1000000000 | floor / 1000000000)'
  input: '[0, 1, 2]'
  expected: |
    [0,0.841470984,0.909297426]
    [1,0.540302305,-0.416146837]
    [0,1.557407724,-2.185039864]

- name: inverse trigonometric functions
  args:
    - -c
    - 'map(asin),map(acos),map(atan) | map(. * 1000000000 | floor / 1000000000)'
  input: '[0, 1, 2]'
  expected: |
    [0,1.570796326,null]
    [1.570796326,0,null]
    [0,0.785398163,1.107148717]

- name: hyperbolic functions
  args:
    - -c
    - 'map(sinh),map(cosh),map(tanh) | map(. * 1000000000 | floor / 1000000000)'
  input: '[0, 1, 2]'
  expected: |
    [0,1.175201193,3.626860407]
    [1,1.543080634,3.762195691]
    [0,0.761594155,0.96402758]

- name: inverse hyperbolic functions
  args:
    - -c
    - 'map(asinh),map(acosh),map(atanh) | map(. * 1000000000 | floor / 1000000000)'
  input: '[0, 1, 2]'
  expected: |
    [0,0.881373587,1.443635475]
    [null,0,1.316957896]
    [0,1.7976931348623157e+308,null]

- name: floor, round, nearbyint, rint, ceil, trunc, fabs, sqrt and cbrt functions
  args:
    - -c
    - 'range(.) | sin | (fabs,sqrt,cbrt,sin) * 100000 | [(floor,round,nearbyint,rint,ceil,trunc) / 100000]'
  input: '5'
  expected: |
    [0,0,0,0,0,0]
    [0,0,0,0,0,0]
    [0,0,0,0,0,0]
    [0,0,0,0,0,0]
    [0.84147,0.84147,0.84147,0.84147,0.84148,0.84147]
    [0.91731,0.91732,0.91732,0.91732,0.91732,0.91731]
    [0.94408,0.94409,0.94409,0.94409,0.94409,0.94408]
    [0.74562,0.74562,0.74562,0.74562,0.74563,0.74562]
    [0.90929,0.9093,0.9093,0.9093,0.9093,0.90929]
    [0.95357,0.95357,0.95357,0.95357,0.95358,0.95357]
    [0.9688,0.9688,0.9688,0.9688,0.96881,0.9688]
    [0.78907,0.78907,0.78907,0.78907,0.78908,0.78907]
    [0.14112,0.14112,0.14112,0.14112,0.14113,0.14112]
    [0.37565,0.37566,0.37566,0.37566,0.37566,0.37565]
    [0.52063,0.52063,0.52063,0.52063,0.52064,0.52063]
    [0.14065,0.14065,0.14065,0.14065,0.14066,0.14065]
    [0.7568,0.7568,0.7568,0.7568,0.75681,0.7568]
    [null,null,null,null,null,null]
    [-0.9113,-0.9113,-0.9113,-0.9113,-0.91129,-0.91129]
    [-0.68661,-0.6866,-0.6866,-0.6866,-0.6866,-0.6866]

- name: exp, exp10, exp2, expm1, pow10 functions
  args:
    - -c
    - '[range(.)] | map(exp),map(exp10),map(exp2),map(expm1),map(pow10) | map(. * 100000 | floor / 100000)'
  input: '10'
  expected: |
    [1,2.71828,7.38905,20.08553,54.59815,148.41315,403.42879,1096.63315,2980.95798,8103.08392]
    [1,10,100,1000,10000,100000,1000000,10000000,100000000,1000000000]
    [1,2,4,8,16,32,64,128,256,512]
    [0,1.71828,6.38905,19.08553,53.59815,147.41315,402.42879,1095.63315,2979.95798,8102.08392]
    [1,10,100,1000,10000,100000,1000000,10000000,100000000,1000000000]

- name: frexp, modf function
  args:
    - -c
    - '[range(.) | tan] | map(frexp),map(modf) | map(map(. * 100000 | floor / 100000))'
  input: '10'
  expected: |
    [[0,0],[0.7787,1],[-0.54626,2],[-0.57019,-2],[0.57891,1],[-0.84513,2],[-0.58202,-1],[0.87144,0],[-0.84997,3],[-0.90464,-1]]
    [[0,0],[0.5574,1],[-0.18504,-2],[-0.14255,-0],[0.15782,1],[-0.38052,-3],[-0.29101,-0],[0.87144,0],[-0.79972,-6],[-0.45232,-0]]

- name: log, log10, log1p, log2, logb functions
  args:
    - '[range(.) | tan] | map(log),map(log10),map(log1p),map(log2),map(logb) | map(. * 100000 | floor / 100000) | tojson'
  input: '10'
  expected: |
    "[-1.7976931348623157e+308,0.44302,null,null,0.14654,null,null,-0.1376,null,null]"
    "[-1.7976931348623157e+308,0.1924,null,null,0.06364,null,null,-0.05976,null,null]"
    "[0,0.93899,null,-0.15379,0.76909,null,-0.34391,0.62671,null,-0.60206]"
    "[-1.7976931348623157e+308,0.63914,null,null,0.21141,null,null,-0.19852,null,null]"
    "[-1.7976931348623157e+308,0,1,-3,0,1,-2,-1,2,-2]"

- name: gamma, tgamma, lgamma functions
  args:
    - '[range(.) | tan] | map(gamma),map(tgamma),map(lgamma) | map(. * 100000 | floor / 100000) | tojson'
  input: '10'
  expected: |
    "[1.7976931348623157e+308,0.88943,-2.39565,-7.75522,0.93049,0.34209,-4.41241,1.09278,-0.00159,-3.58744]"
    "[1.7976931348623157e+308,0.88943,-2.39565,-7.75522,0.93049,0.34209,-4.41241,1.09278,-0.00159,-3.58744]"
    "[1.7976931348623157e+308,-0.11718,0.87365,2.04836,-0.07204,-1.07268,1.48441,0.08872,-6.44927,1.27743]"

- name: erf, erfc, j0, j1, y0, y1 functions
  args:
    - '[range(.) | tan] | map(erf),map(erfc),map(j0),map(j1),map(y0),map(y1) | map(. * 100000 | floor / 100000) | tojson'
  input: '10'
  expected: |
    "[0,0.97237,-0.998,-0.15977,0.89845,-1,-0.31933,0.7822,-1,-0.47762]"
    "[1,0.02762,1.99799,1.15976,0.10154,1.99999,1.31932,0.21779,2,1.47761]"
    "[1,0.47958,0.11869,0.99492,0.69191,-0.36073,0.97894,0.81896,0.29307,0.9495]"
    "[0,0.56529,-0.55806,-0.0711,0.48717,-0.18735,-0.14397,0.39565,0.0653,-0.22043]"
    "[-1.7976931348623157e+308,0.40504,null,null,0.20121,null,null,-0.01971,null,null]"
    "[-1.7976931348623157e+308,-0.37491,null,null,-0.653,null,null,-0.90154,null,null]"

- name: atan2/2, copysign/2, drem/2, fdim/2, fmax/2, fmin/2, fmod/2, hypot/2, jn/2, ldexp/2, nextafter/2, nexttoward/2, remainder/2, scalb/2, scalbln/2, pow/2, yn/2 functions
  args:
    - '[range(-.;.)] | [
         [atan2(.[]; .[])],
         [copysign(.[]; .[])],
         [drem(.[]; .[])],
         [fdim(.[]; .[])],
         [fmax(.[]; .[])],
         [fmin(.[]; .[])],
         [fmod(.[]; .[])],
         [hypot(.[]; .[])],
         [jn(.[]; .[])],
         [ldexp(.[]; .[])],
         [nextafter(.[]; .[])],
         [nexttoward(.[]; .[])],
         [remainder(.[]; .[])],
         [scalb(.[]; .[])],
         [scalbln(.[]; .[])],
         [pow(.[]; .[])],
         [yn(.[]; .[])]
       ] | map([.[] | . * 10000 | round | . / 10000 | if . == 0.0 then 0.0 else . end] | join(","))'
  input: '3'
  expected: |
    [
      "-2.3562,-2.5536,-2.8198,3.1416,2.8198,2.5536,-2.1588,-2.3562,-2.6779,3.1416,2.6779,2.3562,-1.8925,-2.0344,-2.3562,3.1416,2.3562,2.0344,-1.5708,-1.5708,-1.5708,0,1.5708,1.5708,-1.249,-1.1071,-0.7854,0,0.7854,1.1071,-0.9828,-0.7854,-0.4636,0,0.4636,0.7854",
      "-3,-2,-1,0,-1,-2,-3,-2,-1,0,-1,-2,-3,-2,-1,0,-1,-2,3,2,1,0,1,2,3,2,1,0,1,2,3,2,1,0,1,2",
      "0,1,-1,0,1,-1,1,0,-1,0,1,0,0,0,0,0,0,0,null,null,null,null,null,null,0,0,0,0,0,0,1,0,-1,0,1,0",
      "0,1,2,3,4,5,0,0,1,2,3,4,0,0,0,1,2,3,0,0,0,0,1,2,0,0,0,0,0,1,0,0,0,0,0,0",
      "-3,-2,-1,0,1,2,-2,-2,-1,0,1,2,-1,-1,-1,0,1,2,0,0,0,0,1,2,1,1,1,1,1,2,2,2,2,2,2,2",
      "-3,-3,-3,-3,-3,-3,-3,-2,-2,-2,-2,-2,-3,-2,-1,-1,-1,-1,-3,-2,-1,0,0,0,-3,-2,-1,0,1,1,-3,-2,-1,0,1,2",
      "0,-2,-1,0,1,2,-1,0,-1,0,1,0,0,0,0,0,0,0,null,null,null,null,null,null,0,0,0,0,0,0,-1,0,-1,0,1,0",
      "4.2426,3.6056,3.1623,3,3.1623,3.6056,3.6056,2.8284,2.2361,2,2.2361,2.8284,3.1623,2.2361,1.4142,1,1.4142,2.2361,3,2,1,0,1,2,3.1623,2.2361,1.4142,1,1.4142,2.2361,3.6056,2.8284,2.2361,2,2.2361,2.8284",
      "0.3091,0.4861,0.3391,-0.2601,-0.3391,0.4861,0.1289,0.3528,0.5767,0.2239,-0.5767,0.3528,0.0196,0.1149,0.4401,0.7652,-0.4401,0.1149,0,0,0,1,0,0,-0.0196,0.1149,-0.4401,0.7652,0.4401,0.1149,-0.1289,0.3528,-0.5767,0.2239,0.5767,0.3528",
      "-0.375,-0.25,-0.125,0,0.125,0.25,-0.75,-0.5,-0.25,0,0.25,0.5,-1.5,-1,-0.5,0,0.5,1,-3,-2,-1,0,1,2,-6,-4,-2,0,2,4,-12,-8,-4,0,4,8",
      "-3,-2,-1,0,1,2,-3,-2,-1,0,1,2,-3,-2,-1,0,1,2,-3,-2,-1,0,1,2,-3,-2,-1,0,1,2,-3,-2,-1,0,1,2",
      "-3,-2,-1,0,1,2,-3,-2,-1,0,1,2,-3,-2,-1,0,1,2,-3,-2,-1,0,1,2,-3,-2,-1,0,1,2,-3,-2,-1,0,1,2",
      "0,1,-1,0,1,-1,1,0,-1,0,1,0,0,0,0,0,0,0,null,null,null,null,null,null,0,0,0,0,0,0,1,0,-1,0,1,0",
      "-0.375,-0.25,-0.125,0,0.125,0.25,-0.75,-0.5,-0.25,0,0.25,0.5,-1.5,-1,-0.5,0,0.5,1,-3,-2,-1,0,1,2,-6,-4,-2,0,2,4,-12,-8,-4,0,4,8",
      "-0.375,-0.25,-0.125,0,0.125,0.25,-0.75,-0.5,-0.25,0,0.25,0.5,-1.5,-1,-0.5,0,0.5,1,-3,-2,-1,0,1,2,-6,-4,-2,0,2,4,-12,-8,-4,0,4,8",
      "-0.037,-0.125,-1,1.7976931348623157e+308,1,0.125,0.1111,0.25,1,1.7976931348623157e+308,1,0.25,-0.3333,-0.5,-1,1.7976931348623157e+308,1,0.5,1,1,1,1,1,1,-3,-2,-1,0,1,2,9,4,1,0,1,4",
      "null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,1.7976931348623157e+308,-1.7976931348623157e+308,1.7976931348623157e+308,-1.7976931348623157e+308,-1.7976931348623157e+308,-1.7976931348623157e+308,5.8215,-1.6507,0.7812,0.0883,-0.7812,-1.6507,1.1278,-0.6174,0.107,0.5104,-0.107,-0.6174"
    ]

- name: fma/3 function
  args:
    - -c
    - '[range(.) | . * 2 | sin] | [fma(.[]; .[]; .[])] | map(. * 100000 | floor / 100000)'
  input: '3'
  expected: |
    [0,0,0,0,0.82682,-0.68816,0,-0.68816,0.57275,0.90929,0.90929,0.90929,0.90929,1.73611,0.22113,0.90929,0.22113,1.48204,-0.75681,-0.75681,-0.75681,-0.75681,0.07001,-1.44497,-0.75681,-1.44497,-0.18406]

- name: nan and isnan functions
  args:
    - 'nan | ., .+1, isnan'
  input: 'null'
  expected: |
    null
    null
    true

- name: stringify nan and inf
  args:
    - '(2|asin),(1|atanh),(-1|atanh) | tojson,([]|join(",")),.'
  input: 'null'
  expected: |
    "null"
    ""
    null
    "1.7976931348623157e+308"
    ""
    1.7976931348623157e+308
    "-1.7976931348623157e+308"
    ""
    -1.7976931348623157e+308

- name: truncate_stream function
  args:
    - -c
    - '[truncate_stream([[0],1],[[1,0],2],[[1,0]],[[1]])]'
  input: '0 1 2'
  expected: |
    [[[0],1],[[1,0],2],[[1,0]],[[1]]]
    [[[0],2],[[0]]]
    []

- name: fromstream function
  args:
    - -c
    - 'fromstream(0,1,2|truncate_stream([[0],1],[[1,0],2],[[1,0]],[[1]]))'
  input: 'null'
  expected: |
    [1,[2]]
    [2]

- name: stream function
  args:
    - -c
    - 'tostream'
  input: '[0,[1,{"a":1},{"b":2}]]'
  expected: |
    [[0],0]
    [[1,0],1]
    [[1,1,"a"],1]
    [[1,1,"a"]]
    [[1,2,"b"],2]
    [[1,2,"b"]]
    [[1,2]]
    [[1]]

- name: setpath function
  args:
    - -c
    - 'setpath([["a","b",0,1,2],[1,2,"a","b"]][]; 1,2)'
  input: 'null'
  expected: |
    {"a":{"b":[[null,[null,null,1]]]}}
    [null,[null,null,{"a":{"b":1}}]]
    {"a":{"b":[[null,[null,null,2]]]}}
    [null,[null,null,{"a":{"b":2}}]]

- name: setpath function deeply
  args:
    - -c
    - 'setpath(["a","b",0,1]; 1,2)'
  input: '{"a":{"b":[]}}'
  expected: |
    {"a":{"b":[[null,1]]}}
    {"a":{"b":[[null,2]]}}

- name: setpath function negative index
  args:
    - -c
    - 'setpath([-2,0,2][] as $x | [$x]; 4,5)'
  input: '[1,2,3]'
  expected: |
    [1,4,3]
    [4,2,3]
    [1,2,4]
    [1,5,3]
    [5,2,3]
    [1,2,5]

- name: setpath function empty path
  args:
    - -c
    - 'setpath([]; 10)'
  input: 'null'
  expected: |
    10

- name: setpath function error
  args:
    - -c
    - 'setpath(["a","b","c"]; 10)'
  input: '{"a":{"b":[]}}'
  error: |
    expected an object but got: array ([])

- name: setpath function error
  args:
    - -c
    - 'setpath(["a",1]; 10)'
  input: '{"a":{"b":[]}}'
  error: |
    expected an array but got: object ({"b":[]})

- name: setpath function error
  args:
    - -c
    - 'setpath(["a",{}]; 10)'
  input: 'null'
  error: |
    expected a string for object key but got: object ({})

- name: delpaths function
  args:
    - -c
    - 'delpaths([["a",1,"b",1]])'
  input: '{"a":[{},{"b":[1,2,3]}]}'
  expected: |
    {"a":[{},{"b":[1,3]}]}

- name: delpaths function against array
  args:
    - -c
    - 'delpaths([[2],[6],[4]])'
  input: '[1,2,3,4,5]'
  expected: |
    [1,2,4]

- name: delpaths function not found key
  args:
    - -c
    - 'delpaths([["a","b","c"]])'
  input: '{}'
  expected: |
    {}

- name: delpaths function out of index
  args:
    - -c
    - 'delpaths([[2],[-10],[10],[-3]])'
  input: '[1,2,3,4,5]'
  expected: |
    [1,2,4,5]

- name: getpath function
  args:
    - -c
    - 'getpath(["a",1,"b",2])'
  input: '{"a":[{},{"b":[1,2,3]}]}'
  expected: |
    3

- name: getpath function empty path
  args:
    - -c
    - 'getpath([])'
  input: '{"a":[{},{"b":[1,2,3]}]}'
  expected: |
    {"a":[{},{"b":[1,2,3]}]}

- name: getpath function error
  args:
    - -c
    - 'getpath(["a",1,"b","c"])'
  input: '{"a":[{},{"b":[1,2,3]}]}'
  error: |
    cannot getpath with ["a",1,"b","c"] against: object ({"a":[{},{"b":[1,2,3]}]})

- name: setpath, delpaths, getpath functions
  args:
    - -c
    - '["foo",1] as $p | getpath($p), setpath($p; 2), delpaths([$p]), .'
  input: '{"foo":[0,1]} {"bar":false}'
  expected: |
    1
    {"foo":[0,2]}
    {"foo":[0]}
    {"foo":[0,1]}
    null
    {"bar":false,"foo":[null,2]}
    {"bar":false}
    {"bar":false}

- name: setpath to getpath
  args:
    - -c
    - '.[] | try (getpath(["a",0,"b"]) |= 5) catch .'
  input: '[null,{"b":0},{"a":0},{"a":null},{"a":[0,1]},{"a":{"b":1}},{"a":[{}]},{"a":[{"c":3}]}]'
  expected: |
    {"a":[{"b":5}]}
    {"a":[{"b":5}],"b":0}
    "cannot getpath with [\"a\",0,\"b\"] against: object ({\"a\":0})"
    {"a":[{"b":5}]}
    "cannot getpath with [\"a\",0,\"b\"] against: object ({\"a\":[0,1]})"
    "cannot getpath with [\"a\",0,\"b\"] against: object ({\"a\":{\"b\":1}})"
    {"a":[{"b":5}]}
    {"a":[{"b":5,"c":3}]}

- name: map_values function
  args:
    - -c
    - 'map_values(.*2)'
  input: '[1,2,3]'
  expected: |
    [2,4,6]

- name: del function
  args:
    - -c
    - 'del(.), del(empty), del((.foo,.bar,.baz) | .[2,3,0]), del(.foo[0], .bar[0], .foo, .baz.bar[0].x)'
  input: '{"foo": [0,1,2,3,4], "bar": [0,1]}'
  expected: |
    null
    {"bar":[0,1],"foo":[0,1,2,3,4]}
    {"bar":[1],"foo":[1,4]}
    {"bar":[1]}

- name: del function with slice
  args:
    - -c
    - 'del(.[1], .[-6], .[2], .[-3:9])'
  input: '[0, 1, 2, 3, 4, 5, 6, 7, 8, 9]'
  expected: |
    [0,3,5,6,9]

- name: assignment operator against object
  args:
    - -c
    - '.foo.bar = 1'
  input: 'null'
  expected: |
    {"foo":{"bar":1}}

- name: assignment operator against array
  args:
    - -c
    - '.[-1,0] = 3'
  input: '[0,1,2]'
  expected: |
    [3,1,3]

- name: assignment operator against array with slice
  args:
    - -c
    - '.[2:4] = ([], [0], [4,3,2]), .[1:-1] = [3,2], .[2:0] = [.[]], .[10:] = [1], .[-20:-10] = [1]'
  input: '[1,2,3,4,5]'
  expected: |
    [1,2,5]
    [1,2,0,5]
    [1,2,4,3,2,5]
    [1,3,2,5]
    [1,2,1,2,3,4,5,3,4,5]
    [1,2,3,4,5,1]
    [1,1,2,3,4,5]

- name: assignment operator deeply
  args:
    - -c
    - '.foo.[0].bar.[1] = 1'
  input: 'null'
  expected: |
    {"foo":[{"bar":[null,1]}]}

- name: assignment operator deeply
  args:
    - -c
    - '.[2][2] = 1'
  input: '[1]'
  expected: |
    [1,null,[null,null,1]]

- name: assignment operator deeply
  args:
    - -c
    - '.foo[2].bar = 2'
  input: '{"foo":[1], "bar":3}'
  expected: |
    {"bar":3,"foo":[1,null,{"bar":2}]}

- name: assignment operator query
  args:
    - -c
    - '.foo = .bar'
  input: '{"bar":42}'
  expected: |
    {"bar":42,"foo":42}

- name: modify operator
  args:
    - -c
    - '.foo |= .+1'
  input: '{"foo": 1}'
  expected: |
    {"foo":2}

- name: modify operator deeply
  args:
    - -c
    - '.[0].a |= {"old":., "new":(.+1)}'
  input: '[{"a":1,"b":2}]'
  expected: |
    [{"a":{"new":2,"old":1},"b":2}]

- name: modify operator in function
  args:
    - -c
    - 'def inc(x): x |= .+1; inc(.[].a)'
  input: '[{"a":1,"b":2},{"a":2,"b":4},{"a":7,"b":8}]'
  expected: |
    [{"a":2,"b":2},{"a":3,"b":4},{"a":8,"b":8}]

- name: update operators
  args:
    - -c
    - '.[] += 2, .[] -= 2, .[] *= 2, .[] /= 2, .[] %=2'
  input: '[1,2,3]'
  expected: |
    [3,4,5]
    [-1,0,1]
    [2,4,6]
    [0.5,1,1.5]
    [1,0,1]

- name: update operator with query in right hand side
  args:
    - -c
    - '.foo += .foo, .bar //= .foo, .[] /= .foo, .[] = .foo'
  input: '{"foo":2}'
  expected: |
    {"foo":4}
    {"bar":2,"foo":2}
    {"foo":1}
    {"foo":2}

- name: error/0 function
  args:
    - '.foo[] | error'
  input: '{ "foo": ["error message", "bar"] }'
  error: |
    error message

- name: error/0 function error
  args:
    - '.foo | error'
  input: '{ "foo": 1 }'
  error: |
    error cannot be applied to: number (1)

- name: error/1 function
  args:
    - '.foo | error("error message")'
  input: '{ "foo": 1 }'
  error: |
    error message

- name: error/1 function error
  args:
    - '.foo | error({})'
  input: '{ "foo": "error" }'
  error: |
    error cannot be applied to: object ({})

- name: path function identity
  args:
    - 'path(.)'
  input: '{}'
  expected: |
    []

- name: path function deep
  args:
    - -c
    - 'path(.a|.[1,2:3,4].b[5,6])'
  input: '{}'
  expected: |
    ["a",{"end":3,"start":1},"b",5]
    ["a",{"end":4,"start":1},"b",5]
    ["a",{"end":3,"start":2},"b",5]
    ["a",{"end":4,"start":2},"b",5]
    ["a",{"end":3,"start":1},"b",6]
    ["a",{"end":4,"start":1},"b",6]
    ["a",{"end":3,"start":2},"b",6]
    ["a",{"end":4,"start":2},"b",6]

- name: path function select
  args:
    - -c
    - '[path(.[] | select(. > 3))]'
  input: '[1,3,5,7,3,8,9,1]'
  expected: |
    [[2],[3],[5],[6]]

- name: path function recurse
  args:
    - -c
    - '[path(..)]'
  input: '{"a":{"b":[0,1,2]},"c":[3,4]}'
  expected: |
    [[],["a"],["a","b"],["a","b",0],["a","b",1],["a","b",2],["c"],["c",0],["c",1]]

- name: path function nested
  args:
    - -c
    - 'path(.a[path(.b)[0]][path(.b.c)[1]])'
  input: '{"a":{"b":{"c":0}}}'
  expected: |
    ["a","b","c"]

- name: path function and pattern
  args:
    - -c
    - '(.a as $x | (.b,.c)) = "b"'
  input: '{"a":null,"b":null}'
  expected: |
    {"a":null,"b":"b","c":"b"}

- name: path function result
  args:
    - -c
    - '.a[path(.b)[0]]'
  input: '{"a":{"b":0}}'
  expected: |
    0

- name: path function error
  args:
    - 'path(. + 1)'
  input: '0'
  error: |
    invalid path against: number (1)

- name: path function iterate error
  args:
    - 'try ((map(select(.a == 0))[].b) = 10) catch .'
  input: '[{"a":0},{"a":1}]'
  expected: |
    "invalid path on iterating against: array ([{\"a\":0}])"

- name: paths/0 function
  args:
    - -c
    - 'paths'
  input: '[1,[[1,{"a":2},3],{"a":[2]}]]'
  expected: |
    [0]
    [1]
    [1,0]
    [1,0,0]
    [1,0,1]
    [1,0,1,"a"]
    [1,0,2]
    [1,1]
    [1,1,"a"]
    [1,1,"a",0]

- name: paths/1 function
  args:
    - -c
    - 'paths(. > 2)'
  input: '[1,[[1,{"a":2},3],{"a":[2]}]]'
  expected: |
    [1]
    [1,0]
    [1,0,1]
    [1,0,2]
    [1,1]
    [1,1,"a"]

- name: bsearch function
  args:
    - 'bsearch(0,2,4)'
  input: '[1,2,3]'
  expected: |
    -1
    1
    -4

- name: gmtime, localtime functions
  args:
    - -c
    - 'gmtime, localtime'
  input: '1500000000 1567890123.456 1600000000.111'
  expected: | # tested with UTC-7
    [2017,6,14,2,40,0,5,194]
    [2017,6,13,19,40,0,4,193]
    [2019,8,7,21,2,3.4560000889999998,6,249]
    [2019,8,7,14,2,3.4560000889999998,6,249]
    [2020,8,13,12,26,40.111000061,0,256]
    [2020,8,13,5,26,40.111000061,0,256]

- name: mktime, strftime, strflocaltime, todate functions
  args:
    - -c
    - 'mktime, ((.,mktime) | strftime("%Y-%m-%dT%H:%M:%SZ")), ((.,mktime) | strflocaltime("%Y-%m-%dT%H:%M:%S%z")), todate'
  input: |
    [2017,6,14,2,40,0,5,194]
    [2019,8,7,21,2,3.4560000889999998,6,249]
    [2020,8,13,12,26,40.111000061,0,256]
  expected: |
    1500000000
    "2017-07-14T02:40:00Z"
    "2017-07-14T02:40:00Z"
    "2017-07-14T02:40:00-0700"
    "2017-07-13T19:40:00-0700"
    "2017-07-14T02:40:00Z"
    1567890123.456
    "2019-09-07T21:02:03Z"
    "2019-09-07T21:02:03Z"
    "2019-09-07T21:02:03-0700"
    "2019-09-07T14:02:03-0700"
    "2019-09-07T21:02:03Z"
    1600000000.111
    "2020-09-13T12:26:40Z"
    "2020-09-13T12:26:40Z"
    "2020-09-13T12:26:40-0700"
    "2020-09-13T05:26:40-0700"
    "2020-09-13T12:26:40Z"

- name: strptime, fromdate functions
  args:
    - -c
    - 'strptime("%Y-%m-%dT%H:%M:%SZ"), fromdate'
  input: |
    "2017-07-14T02:40:00Z"
    "2019-09-07T21:02:03Z"
    "2020-09-13T12:26:40Z"
  expected: |
    [2017,6,14,2,40,0,5,194]
    1500000000
    [2019,8,7,21,2,3,6,249]
    1567890123
    [2020,8,13,12,26,40,0,256]
    1600000000

- name: now function
  args:
    - -c
    - 'now | type'
  input: 'null'
  expected: |
    "number"

- name: debug function
  args:
    - 'recurse(debug|.[]?)'
  input: '[{}] [1,{"a":2}]'
  expected: |
    [
      {}
    ]
    {}
    [
      1,
      {
        "a": 2
      }
    ]
    1
    {
      "a": 2
    }
    2
  error: |
    ["DEBUG:",[{}]]
    ["DEBUG:",{}]
    ["DEBUG:",[1,{"a":2}]]
    ["DEBUG:",1]
    ["DEBUG:",{"a":2}]
    ["DEBUG:",2]

- name: stderr function
  args:
    - 'recurse(stderr|.[]?)'
  input: '[{}] [1,{"a":2}] "DEBUG:"'
  expected: |
    [
      {}
    ]
    {}
    [
      1,
      {
        "a": 2
      }
    ]
    1
    {
      "a": 2
    }
    2
    "DEBUG:"
  error: |
    [{}]
    {}
    [1,{"a":2}]
    1
    {"a":2}
    2
    "DEBUG:"

- name: halt function
  args:
    - 'def f($n): if $n > 0 then $n, f($n - 1) else halt end; f(.), .'
  input: '3'
  expected: |
    3
    2
    1

- name: builtins function
  args:
    - 'builtins|length > 100'
  input: 'null'
  expected: |
    true

- name: env function
  args:
    - 'env|length > 0'
  input: 'null'
  expected: |
    true

- name: match function
  args:
    - -c
    - '[match("bcd")], [match("☆★"; "g")], (("","g","i","ig") as $flag | [match("bcd"; $flag)]), [match("ABC.?D.?E"; "mg")], [match("A(?<bar>B(C)(.?D))(?<foo>.?E)")], [match("b(?<foo>c)(d)"; "igm")], [match("bc(c(.*))?d")]'
  input: '"abcde☆★abcde☆★ABCDE☆ABC\nD\nE"'
  expected: |
    [{"captures":[],"length":3,"offset":1,"string":"bcd"}]
    [{"captures":[],"length":2,"offset":5,"string":"☆★"},{"captures":[],"length":2,"offset":12,"string":"☆★"}]
    [{"captures":[],"length":3,"offset":1,"string":"bcd"}]
    [{"captures":[],"length":3,"offset":1,"string":"bcd"},{"captures":[],"length":3,"offset":8,"string":"bcd"}]
    [{"captures":[],"length":3,"offset":1,"string":"bcd"}]
    [{"captures":[],"length":3,"offset":1,"string":"bcd"},{"captures":[],"length":3,"offset":8,"string":"bcd"},{"captures":[],"length":3,"offset":15,"string":"BCD"}]
    [{"captures":[],"length":5,"offset":14,"string":"ABCDE"},{"captures":[],"length":7,"offset":20,"string":"ABC\nD\nE"}]
    [{"captures":[{"length":3,"name":"bar","offset":15,"string":"BCD"},{"length":1,"name":null,"offset":16,"string":"C"},{"length":1,"name":null,"offset":17,"string":"D"},{"length":1,"name":"foo","offset":18,"string":"E"}],"length":5,"offset":14,"string":"ABCDE"}]
    [{"captures":[{"length":1,"name":"foo","offset":2,"string":"c"},{"length":1,"name":null,"offset":3,"string":"d"}],"length":3,"offset":1,"string":"bcd"},{"captures":[{"length":1,"name":"foo","offset":9,"string":"c"},{"length":1,"name":null,"offset":10,"string":"d"}],"length":3,"offset":8,"string":"bcd"},{"captures":[{"length":1,"name":"foo","offset":16,"string":"C"},{"length":1,"name":null,"offset":17,"string":"D"}],"length":3,"offset":15,"string":"BCD"}]
    [{"captures":[{"length":0,"name":null,"offset":-1,"string":null},{"length":0,"name":null,"offset":-1,"string":null}],"length":3,"offset":1,"string":"bcd"}]

- name: test function
  args:
    - -c
    - '[test("xyz"), test("bcd"), test("efg"), test("efg"; "i"), test("☆★")]'
  input: '"abcde☆★abcde☆★ABCDEFG"'
  expected: |
    [false,true,false,true,true]

- name: capture function
  args:
    - -c
    - 'capture("bcd"), capture("b(?<foo>c.?(?<bar>d..))"), [capture("(?<a>b(?<foo>c).?(?<bar>d..))"; "gmi")]'
  input: '"abcdeABCDEabcde"'
  expected: |
    {}
    {"bar":"deA","foo":"cdeA"}
    [{"a":"bcdeA","bar":"deA","foo":"c"},{"a":"BCDEa","bar":"DEa","foo":"C"}]

- name: scan function
  args:
    - -c
    - 'scan("(b(c*)(d*))"), scan("(b(c*)(d*))"; "i")'
  input: '"abcdeABCCDDEabcce"'
  expected: |
    ["bcd","c","d"]
    ["bcc","cc",""]
    ["bcd","c","d"]
    ["BCCDD","CC","DD"]
    ["bcc","cc",""]

- name: split/2 function
  args:
    - -c
    - 'split("a"), split("a+"), split("a+"; ""), split("a+"; "i")'
  input: '"abaacaAad"'
  expected: |
    ["","b","","c","A","d"]
    ["abaacaAad"]
    ["","b","c","A","d"]
    ["","b","c","d"]

- name: splits function
  args:
    - -c
    - '[splits("a")], [splits("a+")], [splits("a+"; "")], [splits("a+"; "i")]'
  input: '"abaacaAad"'
  expected: |
    ["","b","","c","A","d"]
    ["","b","c","A","d"]
    ["","b","c","A","d"]
    ["","b","c","d"]

- name: sub function
  args:
    - 'sub("a"; "b"), sub("aaa"; "b"), sub("a(?<a>.)"; "\(.a)b\(.a)"; "ig"), sub("(?<foo>★)"; "\(.foo)☆\(.foo)")'
  input: '"abc☆★☆ABC"'
  expected: |
    "bbc☆★☆ABC"
    "abc☆★☆ABC"
    "bbbc☆★☆BbBC"
    "abc☆★☆★☆ABC"

- name: gsub function
  args:
    - 'gsub("a"; "b"), gsub("a.c"; "b"), gsub("a(?<a>..)"; "\(.a+.a)"; "i"), gsub("(?<foo>★)"; "\(.foo)☆\(.foo)")'
  input: '"abcABC☆★☆ABCabc"'
  expected: |
    "bbcABC☆★☆ABCbbc"
    "bABC☆★☆ABCb"
    "bcbcBCBC☆★☆BCBCbcbc"
    "abcABC☆★☆★☆ABCabc"

- name: INDEX function
  args:
    - -c
    - 'INDEX(range(5); .*2)'
  input: 'null'
  expected: |
    {"0":0,"2":1,"4":2,"6":3,"8":4}

- name: JOIN function
  args:
    - -c
    - '[range(5)] | JOIN(map(.*3); .*2)'
  input: 'null'
  expected: |
    [[0,0],[1,6],[2,12],[3,null],[4,null]]

- name: IN function
  args:
    - -c
    - '[range(5; 13)|IN(range(0; 10; 3))]'
  input: 'null'
  expected: |
    [false,true,false,false,true,false,false,false]

- name: destructuring alternative operator
  args:
    - '.[] | . as {a:$a} ?// [$a] ?// $a | $a'
  input: '[[1],[2],{"a":3},4]'
  expected: |
    1
    2
    3
    4

- name: destructuring alternative operator with error backtrack
  args:
    - -c
    - '.[] | . as {a:$a} ?// [$a] ?// $a | if 1 < $a and $a < 4 then $a|error else $a end'
  input: '[[1],[2],{"a":3},4]'
  expected: |
    1
    [2]
    {"a":3}
    4

- name: destructuring alternative operator with multiple variables
  args:
    - -c
    - '.[] | . as {$a, b: [$c, {$d}]} ?// [$a, {$b}, $e] ?// $f | [$a, $b, $c, $d, $e, $f]'
  input: '[{"a":1,"b":[2,{"d":3}]},[4,{"b":5,"c":6},7,8,9],"foo"]'
  expected: |
    [1,null,2,3,null,null]
    [4,5,null,null,7,null]
    [null,null,null,null,null,"foo"]

- name: compact output option
  args:
    - -c
    - '.'
  input: '{ "foo": ["hello", "world"] }'
  expected: |
    {"foo":["hello","world"]}

- name: compact output long option
  args:
    - --compact-output
    - '.'
  input: '{ "foo": ["hello", "world"] }'
  expected: |
    {"foo":["hello","world"]}

- name: raw string output option
  args:
    - -r
    - '.foo[]'
  input: '{ "foo": ["hello", "world", "multiple\nline"] }'
  expected: |
    hello
    world
    multiple
    line

- name: raw string output long option
  args:
    - --raw-output
    - '.foo[]'
  input: '{ "foo": ["hello", "world", "multiple\nline"] }'
  expected: |
    hello
    world
    multiple
    line

- name: raw string output option against non-string
  args:
    - -r
    - '.'
  input: '{ "foo": "multiple\nline" }'
  expected: |
    {
      "foo": "multiple\nline"
    }

- name: join output option
  args:
    - -j
    - '.[]'
  input: '["foo",1,2,3]'
  expected: "foo123"

- name: join output long option
  args:
    - --join-output
    - '.[]'
  input: '["foo",[{},{}],1,[2,3]]'
  expected: "foo[\n  {},\n  {}\n]1[\n  2,\n  3\n]"

- name: color output option
  args:
    - -C
    - '.'
  input: |
    { "foo": "bar" }
  expected: "{\n  \e[34;1m\"foo\"\e[0m: \e[32m\"bar\"\e[0m\n}\n"

- name: color output long option
  args:
    - --color-output
    - '.'
  input: |
    { "foo": 42 }
  expected: "{\n  \e[34;1m\"foo\"\e[0m: \e[36m42\e[0m\n}\n"

- name: monochrome output option
  args:
    - -C
    - -M
    - '.'
  input: |
    { "foo": "bar" }
  expected: |
    {
      "foo": "bar"
    }

- name: monochrome output long option
  args:
    - -C
    - --monochrome-output
    - '.'
  input: |
    { "foo": 42 }
  expected: |
    {
      "foo": 42
    }

- name: raw strings input option
  args:
    - -R
    - '.'
  input: |
    {
      "foo": "bar"
    }
  expected: |
    "{"
    "  \"foo\": \"bar\""
    "}"

- name: raw strings input long option
  args:
    - --raw-input
    - '.'
  input: |
    {
      "foo": "bar"
    }
  expected: |
    "{"
    "  \"foo\": \"bar\""
    "}"

- name: raw strings input option error
  args:
    - -R
    - '. / 2'
  input: |
    {
      "foo": "bar"
    }
  error: |
    cannot divide: string ("}") and number (2)

- name: null input value option
  args:
    - -n
    - '[.]'
  expected: |
    [
      null
    ]

- name: null input value long option
  args:
    - --null-input
    - '[.]'
  expected: |
    [
      null
    ]

- name: null input value option with compact option
  args:
    - -n
    - -c
    - '[.,.]'
  expected: |
    [null,null]

- name: null input value option with raw strings input option
  args:
    - -n
    - -R
    - '.'
  input: 'foo'
  expected: |
    null

- name: slurp option
  args:
    - -s
    - '.'
  input: |
    null
    false
    []
    { "foo": "bar" }
  expected: |
    [
      null,
      false,
      [],
      {
        "foo": "bar"
      }
    ]

- name: slurp long option
  args:
    - --slurp
    - --compact-output
    - '.'
  input: |
    null
    false
  expected: |
    [null,false]

- name: slurp option with raw strings input option
  args:
    - -s
    - -R
    - '.'
  input: |
    null
    false
    foo
    bar
  expected: |
    "null\nfalse\nfoo\nbar\n"

- name: slurp option with null input option
  args:
    - -s
    - -n
    - '.'
  expected: |
    null

- name: yaml input option
  args:
    - --yaml-input
    - '.'
  input: |
    foo:
      bar: 42
      baz: |
        a
        b
    qux: 100
    ---
    foo: 1
    ---
    bar
  expected: |
    {
      "foo": {
        "bar": 42,
        "baz": "a\nb\n"
      },
      "qux": 100
    }
    {
      "foo": 1
    }
    "bar"

- name: yaml input option with slurp option
  args:
    - --yaml-input
    - --slurp
    - '.'
  input: |
    foo:
      bar: 42
      baz: |
        a
        b
    qux: 100
    ---
    foo: 1
    ---
    bar
  expected: |
    [
      {
        "foo": {
          "bar": 42,
          "baz": "a\nb\n"
        },
        "qux": 100
      },
      {
        "foo": 1
      },
      "bar"
    ]

- name: yaml input option error
  args:
    - --yaml-input
    - '.'
  input: |
    foo: 10
    10
    bar:
  error: |
    invalid yaml: <stdin>
        bar:
        ^  could not find expected ':'

- name: yaml output option
  args:
    - --yaml-output
    - '.'
  input: '{"foo": 128, "bar": {"baz": [1,"qux", []]}}'
  expected: |
    bar:
      baz:
      - 1
      - qux
      - []
    foo: 128

- name: yaml output option with multiple values
  args:
    - --yaml-output
    - '..'
  input: '{"foo": 128, "bar": [1,2,"foo"]}'
  expected: |
    bar:
    - 1
    - 2
    - foo
    foo: 128
    ---
    - 1
    - 2
    - foo
    ---
    1
    ---
    2
    ---
    foo
    ---
    128

- name: yaml input and output option
  args:
    - --yaml-input
    - --yaml-output
    - '.'
  input: |
    foo: 42
    ---
    foo:
      bar: 42
      baz: |
        a
        b
    qux: 100
    ---
    foo: 1
    ---
    bar
  expected: |
    foo: 42
    ---
    foo:
      bar: 42
      baz: |
        a
        b
    qux: 100
    ---
    foo: 1
    ---
    bar

- name: source query from file
  args:
    - -n
    - -f
    - testdata/1.jq
  expected: |
    null

- name: source query from file long option
  args:
    - --null-input
    - --from-file
    - testdata/1.jq
  expected: |
    null

- name: invalid query
  args:
    - '>abc'
  input: '{}'
  error: |
    invalid query: >abc
        >abc
        ^  unexpected ">"

- name: invalid query
  args:
    - '.abc['
  input: '{}'
  error: |
    invalid query: .abc[
        .abc[
            ^  unexpected token "["

- name: invalid query
  args:
    - '[ .[] | { .id } ]'
  input: '{}'
  error: |
    invalid query: [ .[] | { .id } ]
        [ .[] | { .id } ]
              ^  unexpected "|" (expected "]")

- name: invalid query
  args:
    - 'if 0then. else. end'
  input: '{}'
  error: |
    invalid query: if 0then. else. end
        if 0then. else. end
           ^  invalid token '0'

- name: invalid multiple line query
  args:
    - |
       [
         .[]
         | { id } }
       ]
  input: '{}'
  error: |
    invalid query: <arg>:3
        3 |   | { id } }
                       ^  unexpected "}" (expected "]")

- name: invalid query in file
  args:
    - -f
    - testdata/2.jq
  error: |
    invalid query: testdata/2.jq:3
        3 |   bar, []
                 ^  unexpected "," (expected "}")

- name: query file not found
  args:
    - -f
    - testdata/3.jq
  error: |
    open testdata/3.jq: no such file or directory

- name: invalid json eof
  input: '{'
  error: |
    invalid json: <stdin>
        {
         ^  unexpected EOF

- name: invalid json invalid character
  input: |
    {
      "あいうえお" 100
    }
  error: |
    invalid json: <stdin>
          "あいうえお" 100
                       ^  invalid character '1' after object key

- name: invalid json string literal
  input: |
    {
      "いろは": n
    }
  error: |
    invalid json: <stdin>
          "いろは": n
                     ^  invalid character '\n' in literal null (expecting 'u')

- name: multiple json in input
  input: '{}[]{"foo":10}{"bar":[]}'
  expected: |
    {}
    []
    {
      "foo": 10
    }
    {
      "bar": []
    }

- name: json file arguments
  args:
    - '.'
    - 'testdata/1.json'
    - 'testdata/2.json'
  expected: |
    {
      "foo": 10
    }
    [
      {
        "bar": []
      }
    ]

- name: json file error json
  args:
    - '.'
    - 'testdata/3.json'
  error: |
    invalid json: testdata/3.json
        {
         ^  unexpected EOF

- name: json file error json
  args:
    - '.'
    - 'testdata/4.json'
  error: |
    invalid json: testdata/4.json
          bar
          ^  invalid character 'b' looking for beginning of value

- name: json file error json with multibyte character in the error line
  args:
    - '.'
    - 'testdata/5.json'
  error: |
    invalid json: testdata/5.json
          "abcde": :★★★★★★★★★★★★
                   ^  invalid character ':' looking for beginning of value

- name: json file not found
  args:
    - '.'
    - 'testdata/1.json'
    - 'testdata/6.json'
    - 'testdata/2.json'
  expected: |
    {
      "foo": 10
    }
  error: 'open testdata/6.json:'
